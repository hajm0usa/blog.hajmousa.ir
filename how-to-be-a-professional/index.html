<!doctype html>
<html class="not-ready lg:text-base overflow-y-scroll scroll-pt-14 scheme-light dark:scheme-dark" lang="en">

<head prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="Zola v0.21.0" />
  <title>The Professional Django & Django REST Framework Handbook | HajMousa;s DevBlog</title>
  <meta property="og:site_name" content="HajMousa;s DevBlog" />
  <meta property="og:title" content="The Professional Django &amp; Django REST Framework Handbook" />
  <meta property="og:url" content="https://blog.hajmousa.ir/how-to-be-a-professional/" />
  <link rel="canonical" href="https://blog.hajmousa.ir/how-to-be-a-professional/" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-12-09T00:00:00+00:00" />
  <link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed" />
  <!-- Begin Head inject -->
  
  <!-- End Head inject -->
  <link rel="stylesheet" href="https://blog.hajmousa.ir/main.min.css?h=80ece4d015818ae93fff" />
  <link rel="stylesheet" href="https://blog.hajmousa.ir/icons.css?h=7dd5ab449fa840fc01e2" />
  <style>:root{--bg: #f4f4f5; --header: #e4e4e7;} :root.dark{--bg: #18181b; --header: #27272a;}</style>
  <link rel="icon" type="image/x-icon" href="https://blog.hajmousa.ir/favicon.ico" />
  <link rel="apple-touch-icon" type="image/png" href="https://blog.hajmousa.ir/apple-touch-icon.png?h=58bee300054c5308feb3" />
  <link rel="icon" type="image/png" href="https://blog.hajmousa.ir/android-icon.png?h=8d80ec95446bd2c36826" />
  <script src="https://blog.hajmousa.ir/js/zola-theme.min.js?h=26975b146d48e6ff41af"></script>
  <!-- Begin Head End inject -->
  
  <!-- End Head End inject -->
</head>

<body class="text-black duration-100 ease-out dark:text-white">
  <!-- Header -->
<header class="blur-header fixed top-0 z-40 mx-auto min-h-13 w-full">
  <div class="mx-auto w-full max-w-4xl p-2.5 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center min-h-8 overflow-hidden">
        <a title="Go to home page [Alt + !]" accesskey="!"
          href="https://blog.hajmousa.ir/"
          class="text-2xl font-semibold truncate">HajMousa;s DevBlog</a>
        <button type="button" title="Switch color scheme [Alt + $]" accesskey="$"
          onclick="window.zolaTheme.color.toggle();"
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-btn-dark,url(icons/btn-dark.svg))]
            dark:[background-image:var(--icons-btn-light,url(icons/btn-light.svg))] dark:invert"
        ></button>
        <button type="button" title="Open search [Alt + /]" accesskey="/"
          onclick="window.zolaTheme.search.toggle();"
          class="btn-search ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-search,url(icons/search.svg))] dark:invert"
        ></button>
      </div>
    </div>
  </div>
</header>

  <!-- Begin Body Start inject -->
  
  <!-- End Body Start inject -->
  <main class="prose prose-neutral dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg
    relative mx-auto min-h-[calc(100vh-4rem)] max-w-3xl px-4 pt-28 lg:pt-32 pb-12 wrap-break-word">
      <!-- Search -->
<div id="linkita-search-wrapper" class="hidden">
  <ul id="linkita-search-results"></ul>
</div>
<script>window.zolaTheme.search.init({ scripts: ["https://blog.hajmousa.ir/elasticlunr.min.js", "https://blog.hajmousa.ir/search_index.en.js"], arg: { w: "#linkita-search-wrapper", r: "#linkita-search-results" } });</script>

    
<article>
  <!-- Begin Page Start inject -->
  
  <!-- End Page Start inject -->

  <header class="mb-16">
    <h1 class="my-0! pb-2.5">The Professional Django &amp; Django REST Framework Handbook</h1>
    <!-- Page Info -->
<div class="text-sm antialiased opacity-80"><time
      datetime="2025-12-09T00:00:00+00:00">2025-12-09</time><span
        class="middot"></span><time
    datetime="PT0H3M0S">3&nbsp;min</time><span
      class="middot"></span>
</div>

  </header>
  <!-- TOC -->
<nav class="block-bg prose-a:secondary-link mb-12 rounded-lg p-2 text-lg">
  <details>
    <summary class="select-none py-0.5 lg:py-1 pl-3.5" title="[Alt + =]" accesskey="=">
      <span class="cursor-pointer ml-0.5">Table of Contents</span>
    </summary>
    <ul class="ps-8">
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#introduction">Introduction</a>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#part-1-django-fundamentals">Part 1: Django Fundamentals</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#understanding-django-s-philosophy">Understanding Django&#x27;s Philosophy</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#project-structure">Project Structure</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#part-2-models-the-foundation">Part 2: Models - The Foundation</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#model-design-principles">Model Design Principles</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#essential-model-patterns">Essential Model Patterns</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#relationships-done-right">Relationships Done Right</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#query-optimization">Query Optimization</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#model-validation">Model Validation</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#signals-use-sparingly">Signals - Use Sparingly</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#part-3-django-rest-framework-serializers">Part 3: Django REST Framework Serializers</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#basic-serializers">Basic Serializers</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#advanced-serializer-patterns">Advanced Serializer Patterns</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#validation">Validation</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#handling-relationships">Handling Relationships</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#context-and-request-access">Context and Request Access</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#performance-optimization">Performance Optimization</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#part-4-views-and-viewsets">Part 4: Views and ViewSets</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#function-based-views-fbv">Function-Based Views (FBV)</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#apiview-class-based-views">APIView - Class-Based Views</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#generic-views">Generic Views</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#viewsets-the-professional-choice">ViewSets - The Professional Choice</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#pagination">Pagination</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#filtering-searching-ordering">Filtering, Searching, Ordering</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#throttling">Throttling</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#exception-handling">Exception Handling</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#part-5-routers">Part 5: Routers</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#simple-router">Simple Router</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#default-router-with-api-root">Default Router (with API Root)</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#custom-actions-and-routes">Custom Actions and Routes</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#nested-routers">Nested Routers</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#custom-router-configuration">Custom Router Configuration</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#multiple-api-versions">Multiple API Versions</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#part-6-authentication-and-permissions">Part 6: Authentication and Permissions</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#authentication-classes">Authentication Classes</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#permission-classes">Permission Classes</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="#part-7-advanced-patterns">Part 7: Advanced Patterns</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#versioning">Versioning</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="#caching">Caching</a>
          </li>
        </ul>
      </li>
    </ul>
  </details>
</nav>

  <!-- Content -->
  <section><h2 id="introduction">Introduction</h2>
<p>This handbook is your comprehensive guide to becoming a professional Django and Django REST Framework (DRF) developer. We'll cover everything from fundamental concepts to advanced patterns that separate junior developers from seasoned professionals.</p>
<h2 id="part-1-django-fundamentals">Part 1: Django Fundamentals</h2>
<h3 id="understanding-django-s-philosophy">Understanding Django's Philosophy</h3>
<p>Django follows the "batteries included" philosophy, providing everything you need out of the box. Professional developers understand these core principles:</p>
<ul>
<li><strong>Don't Repeat Yourself (DRY)</strong>: Write reusable code</li>
<li><strong>Convention over Configuration</strong>: Follow Django's patterns</li>
<li><strong>Explicit is better than implicit</strong>: Clear, readable code wins</li>
<li><strong>Loose coupling, high cohesion</strong>: Components should be independent but focused</li>
</ul>
<h3 id="project-structure">Project Structure</h3>
<p>A professional Django project structure looks like this:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>myproject/
</span><span>├── manage.py
</span><span>├── myproject/
</span><span>│   ├── __init__.py
</span><span>│   ├── settings/
</span><span>│   │   ├── __init__.py
</span><span>│   │   ├── base.py
</span><span>│   │   ├── development.py
</span><span>│   │   ├── production.py
</span><span>│   │   └── testing.py
</span><span>│   ├── urls.py
</span><span>│   ├── wsgi.py
</span><span>│   └── asgi.py
</span><span>├── apps/
</span><span>│   ├── users/
</span><span>│   ├── products/
</span><span>│   └── orders/
</span><span>├── requirements/
</span><span>│   ├── base.txt
</span><span>│   ├── development.txt
</span><span>│   └── production.txt
</span><span>├── static/
</span><span>├── media/
</span><span>├── templates/
</span><span>└── tests/
</span></code></pre>
<h2 id="part-2-models-the-foundation">Part 2: Models - The Foundation</h2>
<h3 id="model-design-principles">Model Design Principles</h3>
<p>Professional model design considers:</p>
<ol>
<li><strong>Normalization vs Denormalization</strong>: Balance database efficiency with query performance</li>
<li><strong>Single Responsibility</strong>: Each model should represent one concept</li>
<li><strong>Relationships</strong>: Use appropriate relationship types</li>
<li><strong>Database Constraints</strong>: Enforce data integrity at the database level</li>
</ol>
<h3 id="essential-model-patterns">Essential Model Patterns</h3>
<h4 id="abstract-base-models">Abstract Base Models</h4>
<p>Create reusable model behaviors:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>models
</span><span style="color:#b48ead;">from </span><span>django.utils </span><span style="color:#b48ead;">import </span><span>timezone
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">TimeStampedModel</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Abstract model providing created and modified timestamps.&quot;&quot;&quot;
</span><span>    created_at = models.</span><span style="color:#bf616a;">DateTimeField</span><span>(</span><span style="color:#bf616a;">auto_now_add</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    updated_at = models.</span><span style="color:#bf616a;">DateTimeField</span><span>(</span><span style="color:#bf616a;">auto_now</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        abstract = </span><span style="color:#d08770;">True
</span><span>        ordering = [&#39;</span><span style="color:#a3be8c;">-created_at</span><span>&#39;]
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">SoftDeleteModel</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Abstract model providing soft delete functionality.&quot;&quot;&quot;
</span><span>    is_deleted = models.</span><span style="color:#bf616a;">BooleanField</span><span>(</span><span style="color:#bf616a;">default</span><span>=</span><span style="color:#d08770;">False</span><span>)
</span><span>    deleted_at = models.</span><span style="color:#bf616a;">DateTimeField</span><span>(</span><span style="color:#bf616a;">null</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">blank</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        abstract = </span><span style="color:#d08770;">True
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">delete</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">using</span><span>=</span><span style="color:#d08770;">None</span><span>, </span><span style="color:#bf616a;">keep_parents</span><span>=</span><span style="color:#d08770;">False</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Soft delete instead of actual deletion.&quot;&quot;&quot;
</span><span>        </span><span style="color:#bf616a;">self</span><span>.is_deleted = </span><span style="color:#d08770;">True
</span><span>        </span><span style="color:#bf616a;">self</span><span>.deleted_at = timezone.</span><span style="color:#bf616a;">now</span><span>()
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">save</span><span>()
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">hard_delete</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Actually delete the record.&quot;&quot;&quot;
</span><span>        </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">delete</span><span>()
</span></code></pre>
<h4 id="using-model-managers">Using Model Managers</h4>
<p>Custom managers encapsulate query logic:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>models
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ActiveManager</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Manager</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Manager that returns only non-deleted records.&quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_queryset</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">get_queryset</span><span>().</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">is_deleted</span><span>=</span><span style="color:#d08770;">False</span><span>)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Product</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">TimeStampedModel</span><span style="color:#eff1f5;">, </span><span style="color:#a3be8c;">SoftDeleteModel</span><span style="color:#eff1f5;">):
</span><span>    name = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">200</span><span>)
</span><span>    price = models.</span><span style="color:#bf616a;">DecimalField</span><span>(</span><span style="color:#bf616a;">max_digits</span><span>=</span><span style="color:#d08770;">10</span><span>, </span><span style="color:#bf616a;">decimal_places</span><span>=</span><span style="color:#d08770;">2</span><span>)
</span><span>    stock = models.</span><span style="color:#bf616a;">IntegerField</span><span>(</span><span style="color:#bf616a;">default</span><span>=</span><span style="color:#d08770;">0</span><span>)
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Multiple managers
</span><span>    objects = models.</span><span style="color:#bf616a;">Manager</span><span>()  </span><span style="color:#65737e;"># Default manager
</span><span>    active = </span><span style="color:#bf616a;">ActiveManager</span><span>()     </span><span style="color:#65737e;"># Custom manager
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        db_table = &#39;</span><span style="color:#a3be8c;">products</span><span>&#39;
</span><span>        indexes = [
</span><span>            models.</span><span style="color:#bf616a;">Index</span><span>(</span><span style="color:#bf616a;">fields</span><span>=[&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;]),
</span><span>            models.</span><span style="color:#bf616a;">Index</span><span>(</span><span style="color:#bf616a;">fields</span><span>=[&#39;</span><span style="color:#a3be8c;">-created_at</span><span>&#39;]),
</span><span>        ]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__str__</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">self</span><span>.name
</span><span>    
</span><span>    @</span><span style="color:#96b5b4;">property
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">is_in_stock</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">self</span><span>.stock &gt; </span><span style="color:#d08770;">0
</span></code></pre>
<h4 id="model-methods-vs-properties">Model Methods vs Properties</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Order</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">TimeStampedModel</span><span style="color:#eff1f5;">):
</span><span>    user = models.</span><span style="color:#bf616a;">ForeignKey</span><span>(&#39;</span><span style="color:#a3be8c;">users.User</span><span>&#39;, </span><span style="color:#bf616a;">on_delete</span><span>=models.</span><span style="color:#bf616a;">CASCADE</span><span>)
</span><span>    status = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">20</span><span>, </span><span style="color:#bf616a;">choices</span><span>=[
</span><span>        (&#39;</span><span style="color:#a3be8c;">pending</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">Pending</span><span>&#39;),
</span><span>        (&#39;</span><span style="color:#a3be8c;">processing</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">Processing</span><span>&#39;),
</span><span>        (&#39;</span><span style="color:#a3be8c;">completed</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">Completed</span><span>&#39;),
</span><span>        (&#39;</span><span style="color:#a3be8c;">cancelled</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">Cancelled</span><span>&#39;),
</span><span>    ])
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Property for simple calculations
</span><span>    @</span><span style="color:#96b5b4;">property
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">total_amount</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#96b5b4;">sum</span><span>(item.subtotal </span><span style="color:#b48ead;">for </span><span>item </span><span style="color:#b48ead;">in </span><span style="color:#bf616a;">self</span><span>.items.</span><span style="color:#bf616a;">all</span><span>())
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Method for actions
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">cancel</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.status in [&#39;</span><span style="color:#a3be8c;">pending</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">processing</span><span>&#39;]:
</span><span>            </span><span style="color:#bf616a;">self</span><span>.status = &#39;</span><span style="color:#a3be8c;">cancelled</span><span>&#39;
</span><span>            </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">save</span><span>()
</span><span>            </span><span style="color:#65737e;"># Trigger any necessary side effects
</span><span>            </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">refund_payment</span><span>()
</span><span>            </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_cancellation_email</span><span>()
</span><span>        </span><span style="color:#b48ead;">else</span><span>:
</span><span>            </span><span style="color:#b48ead;">raise </span><span style="color:#bf616a;">ValueError</span><span>(&quot;</span><span style="color:#a3be8c;">Cannot cancel completed orders</span><span>&quot;)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">refund_payment</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;"># Payment refund logic
</span><span>        </span><span style="color:#b48ead;">pass
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_cancellation_email</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;"># Email logic
</span><span>        </span><span style="color:#b48ead;">pass
</span></code></pre>
<h4 id="advanced-field-types">Advanced Field Types</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.contrib.postgres.fields </span><span style="color:#b48ead;">import </span><span>ArrayField, JSONField
</span><span style="color:#b48ead;">from </span><span>django.core.validators </span><span style="color:#b48ead;">import </span><span>MinValueValidator, MaxValueValidator
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Product</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;"># Text fields with validation
</span><span>    name = models.</span><span style="color:#bf616a;">CharField</span><span>(
</span><span>        </span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">200</span><span>,
</span><span>        </span><span style="color:#bf616a;">db_index</span><span>=</span><span style="color:#d08770;">True</span><span>,
</span><span>        </span><span style="color:#bf616a;">help_text</span><span>=&quot;</span><span style="color:#a3be8c;">Product name</span><span>&quot;
</span><span>    )
</span><span>    slug = models.</span><span style="color:#bf616a;">SlugField</span><span>(</span><span style="color:#bf616a;">unique</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">200</span><span>)
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Numeric fields with validators
</span><span>    price = models.</span><span style="color:#bf616a;">DecimalField</span><span>(
</span><span>        </span><span style="color:#bf616a;">max_digits</span><span>=</span><span style="color:#d08770;">10</span><span>,
</span><span>        </span><span style="color:#bf616a;">decimal_places</span><span>=</span><span style="color:#d08770;">2</span><span>,
</span><span>        </span><span style="color:#bf616a;">validators</span><span>=[</span><span style="color:#bf616a;">MinValueValidator</span><span>(</span><span style="color:#d08770;">0</span><span>)]
</span><span>    )
</span><span>    discount_percentage = models.</span><span style="color:#bf616a;">IntegerField</span><span>(
</span><span>        </span><span style="color:#bf616a;">default</span><span>=</span><span style="color:#d08770;">0</span><span>,
</span><span>        </span><span style="color:#bf616a;">validators</span><span>=[</span><span style="color:#bf616a;">MinValueValidator</span><span>(</span><span style="color:#d08770;">0</span><span>), </span><span style="color:#bf616a;">MaxValueValidator</span><span>(</span><span style="color:#d08770;">100</span><span>)]
</span><span>    )
</span><span>    
</span><span>    </span><span style="color:#65737e;"># PostgreSQL-specific fields
</span><span>    tags = </span><span style="color:#bf616a;">ArrayField</span><span>(
</span><span>        models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">50</span><span>),
</span><span>        </span><span style="color:#bf616a;">blank</span><span>=</span><span style="color:#d08770;">True</span><span>,
</span><span>        </span><span style="color:#bf616a;">default</span><span>=list
</span><span>    )
</span><span>    metadata = models.</span><span style="color:#bf616a;">JSONField</span><span>(</span><span style="color:#bf616a;">default</span><span>=dict, </span><span style="color:#bf616a;">blank</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span>    </span><span style="color:#65737e;"># File fields
</span><span>    image = models.</span><span style="color:#bf616a;">ImageField</span><span>(</span><span style="color:#bf616a;">upload_to</span><span>=&#39;</span><span style="color:#a3be8c;">products/</span><span style="color:#d08770;">%Y</span><span style="color:#a3be8c;">/</span><span style="color:#d08770;">%m</span><span style="color:#a3be8c;">/</span><span style="color:#d08770;">%d</span><span style="color:#a3be8c;">/</span><span>&#39;)
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Choices using TextChoices (Django 3.0+)
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CategoryChoices</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.TextChoices</span><span style="color:#eff1f5;">):
</span><span>        </span><span style="color:#bf616a;">ELECTRONICS </span><span>= &#39;</span><span style="color:#a3be8c;">ELEC</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">Electronics</span><span>&#39;
</span><span>        </span><span style="color:#bf616a;">CLOTHING </span><span>= &#39;</span><span style="color:#a3be8c;">CLTH</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">Clothing</span><span>&#39;
</span><span>        </span><span style="color:#bf616a;">BOOKS </span><span>= &#39;</span><span style="color:#a3be8c;">BOOK</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">Books</span><span>&#39;
</span><span>    
</span><span>    category = models.</span><span style="color:#bf616a;">CharField</span><span>(
</span><span>        </span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">4</span><span>,
</span><span>        </span><span style="color:#bf616a;">choices</span><span>=CategoryChoices.choices,
</span><span>        </span><span style="color:#bf616a;">default</span><span>=CategoryChoices.</span><span style="color:#bf616a;">ELECTRONICS
</span><span>    )
</span></code></pre>
<h3 id="relationships-done-right">Relationships Done Right</h3>
<h4 id="one-to-many">One-to-Many</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Author</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    name = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">100</span><span>)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Book</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    title = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">200</span><span>)
</span><span>    author = models.</span><span style="color:#bf616a;">ForeignKey</span><span>(
</span><span>        Author,
</span><span>        </span><span style="color:#bf616a;">on_delete</span><span>=models.</span><span style="color:#bf616a;">CASCADE</span><span>,  </span><span style="color:#65737e;"># Delete books when author is deleted
</span><span>        </span><span style="color:#bf616a;">related_name</span><span>=&#39;</span><span style="color:#a3be8c;">books</span><span>&#39;  </span><span style="color:#65737e;"># Access books via author.books.all()
</span><span>    )
</span></code></pre>
<h4 id="many-to-many-with-through-model">Many-to-Many with Through Model</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Student</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    name = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">100</span><span>)
</span><span>    courses = models.</span><span style="color:#bf616a;">ManyToManyField</span><span>(
</span><span>        &#39;</span><span style="color:#a3be8c;">Course</span><span>&#39;,
</span><span>        </span><span style="color:#bf616a;">through</span><span>=&#39;</span><span style="color:#a3be8c;">Enrollment</span><span>&#39;,
</span><span>        </span><span style="color:#bf616a;">related_name</span><span>=&#39;</span><span style="color:#a3be8c;">students</span><span>&#39;
</span><span>    )
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Course</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    name = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">100</span><span>)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Enrollment</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Through model with additional fields.&quot;&quot;&quot;
</span><span>    student = models.</span><span style="color:#bf616a;">ForeignKey</span><span>(Student, </span><span style="color:#bf616a;">on_delete</span><span>=models.</span><span style="color:#bf616a;">CASCADE</span><span>)
</span><span>    course = models.</span><span style="color:#bf616a;">ForeignKey</span><span>(Course, </span><span style="color:#bf616a;">on_delete</span><span>=models.</span><span style="color:#bf616a;">CASCADE</span><span>)
</span><span>    enrolled_date = models.</span><span style="color:#bf616a;">DateField</span><span>(</span><span style="color:#bf616a;">auto_now_add</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    grade = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">2</span><span>, </span><span style="color:#bf616a;">blank</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        unique_together = [&#39;</span><span style="color:#a3be8c;">student</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">course</span><span>&#39;]
</span></code></pre>
<h4 id="one-to-one">One-to-One</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">User</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">AbstractUser</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#b48ead;">pass
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Profile</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    user = models.</span><span style="color:#bf616a;">OneToOneField</span><span>(
</span><span>        User,
</span><span>        </span><span style="color:#bf616a;">on_delete</span><span>=models.</span><span style="color:#bf616a;">CASCADE</span><span>,
</span><span>        </span><span style="color:#bf616a;">related_name</span><span>=&#39;</span><span style="color:#a3be8c;">profile</span><span>&#39;
</span><span>    )
</span><span>    bio = models.</span><span style="color:#bf616a;">TextField</span><span>(</span><span style="color:#bf616a;">blank</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    avatar = models.</span><span style="color:#bf616a;">ImageField</span><span>(</span><span style="color:#bf616a;">upload_to</span><span>=&#39;</span><span style="color:#a3be8c;">avatars/</span><span>&#39;, </span><span style="color:#bf616a;">null</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__str__</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">return f</span><span>&quot;{</span><span style="color:#bf616a;">self</span><span>.user.username}</span><span style="color:#a3be8c;">&#39;s profile</span><span>&quot;
</span></code></pre>
<h3 id="query-optimization">Query Optimization</h3>
<p>Professional developers write efficient queries:</p>
<h4 id="select-related-and-prefetch-related">Select Related and Prefetch Related</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># Bad: N+1 query problem
</span><span>books = Book.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span style="color:#b48ead;">for </span><span>book </span><span style="color:#b48ead;">in </span><span>books:
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(book.author.name)  </span><span style="color:#65737e;"># Hits database for each book!
</span><span>
</span><span style="color:#65737e;"># Good: Use select_related for ForeignKey
</span><span>books = Book.objects.</span><span style="color:#bf616a;">select_related</span><span>(&#39;</span><span style="color:#a3be8c;">author</span><span>&#39;).</span><span style="color:#bf616a;">all</span><span>()
</span><span style="color:#b48ead;">for </span><span>book </span><span style="color:#b48ead;">in </span><span>books:
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(book.author.name)  </span><span style="color:#65737e;"># No additional queries
</span><span>
</span><span style="color:#65737e;"># Prefetch related for reverse ForeignKey and ManyToMany
</span><span>authors = Author.objects.</span><span style="color:#bf616a;">prefetch_related</span><span>(&#39;</span><span style="color:#a3be8c;">books</span><span>&#39;).</span><span style="color:#bf616a;">all</span><span>()
</span><span style="color:#b48ead;">for </span><span>author </span><span style="color:#b48ead;">in </span><span>authors:
</span><span>    </span><span style="color:#b48ead;">for </span><span>book </span><span style="color:#b48ead;">in </span><span>author.books.</span><span style="color:#bf616a;">all</span><span>():  </span><span style="color:#65737e;"># Uses prefetched data
</span><span>        </span><span style="color:#96b5b4;">print</span><span>(book.title)
</span></code></pre>
<h4 id="advanced-prefetching">Advanced Prefetching</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.db.models </span><span style="color:#b48ead;">import </span><span>Prefetch
</span><span>
</span><span style="color:#65737e;"># Prefetch with filtering
</span><span>active_orders = Order.objects.</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">status</span><span>=&#39;</span><span style="color:#a3be8c;">active</span><span>&#39;)
</span><span>customers = Customer.objects.</span><span style="color:#bf616a;">prefetch_related</span><span>(
</span><span>    </span><span style="color:#bf616a;">Prefetch</span><span>(&#39;</span><span style="color:#a3be8c;">orders</span><span>&#39;, </span><span style="color:#bf616a;">queryset</span><span>=active_orders, </span><span style="color:#bf616a;">to_attr</span><span>=&#39;</span><span style="color:#a3be8c;">active_orders</span><span>&#39;)
</span><span>)
</span><span>
</span><span style="color:#65737e;"># Multi-level prefetching
</span><span>orders = Order.objects.</span><span style="color:#bf616a;">prefetch_related</span><span>(
</span><span>    &#39;</span><span style="color:#a3be8c;">items__product</span><span>&#39;,
</span><span>    &#39;</span><span style="color:#a3be8c;">items__product__category</span><span>&#39;
</span><span>).</span><span style="color:#bf616a;">select_related</span><span>(&#39;</span><span style="color:#a3be8c;">user</span><span>&#39;)
</span></code></pre>
<h4 id="using-only-and-defer">Using only() and defer()</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># Load only specific fields
</span><span>products = Product.objects.</span><span style="color:#bf616a;">only</span><span>(&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;)
</span><span>
</span><span style="color:#65737e;"># Defer loading of heavy fields
</span><span>products = Product.objects.</span><span style="color:#bf616a;">defer</span><span>(&#39;</span><span style="color:#a3be8c;">description</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">metadata</span><span>&#39;)
</span></code></pre>
<h4 id="aggregation-and-annotation">Aggregation and Annotation</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.db.models </span><span style="color:#b48ead;">import </span><span>Count, Sum, Avg, F, Q, Value
</span><span style="color:#b48ead;">from </span><span>django.db.models.functions </span><span style="color:#b48ead;">import </span><span>Coalesce
</span><span>
</span><span style="color:#65737e;"># Simple aggregation
</span><span style="color:#b48ead;">from </span><span>django.db.models </span><span style="color:#b48ead;">import </span><span>Count
</span><span>Author.objects.</span><span style="color:#bf616a;">aggregate</span><span>(</span><span style="color:#bf616a;">total_books</span><span>=</span><span style="color:#bf616a;">Count</span><span>(&#39;</span><span style="color:#a3be8c;">books</span><span>&#39;))
</span><span>
</span><span style="color:#65737e;"># Annotation adds calculated fields to each object
</span><span>authors = Author.objects.</span><span style="color:#bf616a;">annotate</span><span>(
</span><span>    </span><span style="color:#bf616a;">book_count</span><span>=</span><span style="color:#bf616a;">Count</span><span>(&#39;</span><span style="color:#a3be8c;">books</span><span>&#39;),
</span><span>    </span><span style="color:#bf616a;">total_sales</span><span>=</span><span style="color:#bf616a;">Sum</span><span>(&#39;</span><span style="color:#a3be8c;">books__sales</span><span>&#39;)
</span><span>).</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">book_count__gte</span><span>=</span><span style="color:#d08770;">3</span><span>)
</span><span>
</span><span style="color:#65737e;"># F expressions for database-level operations
</span><span>Product.objects.</span><span style="color:#bf616a;">update</span><span>(</span><span style="color:#bf616a;">price</span><span>=</span><span style="color:#bf616a;">F</span><span>(&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;) * </span><span style="color:#d08770;">1.1</span><span>)  </span><span style="color:#65737e;"># 10% price increase
</span><span>
</span><span style="color:#65737e;"># Complex annotations
</span><span>orders = Order.objects.</span><span style="color:#bf616a;">annotate</span><span>(
</span><span>    </span><span style="color:#bf616a;">item_count</span><span>=</span><span style="color:#bf616a;">Count</span><span>(&#39;</span><span style="color:#a3be8c;">items</span><span>&#39;),
</span><span>    </span><span style="color:#bf616a;">total</span><span>=</span><span style="color:#bf616a;">Sum</span><span>(</span><span style="color:#bf616a;">F</span><span>(&#39;</span><span style="color:#a3be8c;">items__quantity</span><span>&#39;) * </span><span style="color:#bf616a;">F</span><span>(&#39;</span><span style="color:#a3be8c;">items__price</span><span>&#39;)),
</span><span>    </span><span style="color:#bf616a;">discounted_total</span><span>=</span><span style="color:#bf616a;">Coalesce</span><span>(
</span><span>        </span><span style="color:#bf616a;">Sum</span><span>(</span><span style="color:#bf616a;">F</span><span>(&#39;</span><span style="color:#a3be8c;">items__quantity</span><span>&#39;) * </span><span style="color:#bf616a;">F</span><span>(&#39;</span><span style="color:#a3be8c;">items__price</span><span>&#39;) * (</span><span style="color:#d08770;">100 </span><span>- </span><span style="color:#bf616a;">F</span><span>(&#39;</span><span style="color:#a3be8c;">discount</span><span>&#39;)) / </span><span style="color:#d08770;">100</span><span>),
</span><span>        </span><span style="color:#bf616a;">Value</span><span>(</span><span style="color:#d08770;">0</span><span>)
</span><span>    )
</span><span>)
</span><span>
</span><span style="color:#65737e;"># Conditional aggregation
</span><span style="color:#b48ead;">from </span><span>django.db.models </span><span style="color:#b48ead;">import </span><span>Case, When
</span><span>
</span><span>Product.objects.</span><span style="color:#bf616a;">aggregate</span><span>(
</span><span>    </span><span style="color:#bf616a;">expensive_count</span><span>=</span><span style="color:#bf616a;">Count</span><span>(</span><span style="color:#bf616a;">Case</span><span>(</span><span style="color:#bf616a;">When</span><span>(</span><span style="color:#bf616a;">price__gte</span><span>=</span><span style="color:#d08770;">100</span><span>, </span><span style="color:#bf616a;">then</span><span>=</span><span style="color:#d08770;">1</span><span>))),
</span><span>    </span><span style="color:#bf616a;">cheap_count</span><span>=</span><span style="color:#bf616a;">Count</span><span>(</span><span style="color:#bf616a;">Case</span><span>(</span><span style="color:#bf616a;">When</span><span>(</span><span style="color:#bf616a;">price__lt</span><span>=</span><span style="color:#d08770;">100</span><span>, </span><span style="color:#bf616a;">then</span><span>=</span><span style="color:#d08770;">1</span><span>)))
</span><span>)
</span></code></pre>
<h3 id="model-validation">Model Validation</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.core.exceptions </span><span style="color:#b48ead;">import </span><span>ValidationError
</span><span style="color:#b48ead;">from </span><span>django.core.validators </span><span style="color:#b48ead;">import </span><span>validate_email
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Product</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>    name = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">200</span><span>)
</span><span>    price = models.</span><span style="color:#bf616a;">DecimalField</span><span>(</span><span style="color:#bf616a;">max_digits</span><span>=</span><span style="color:#d08770;">10</span><span>, </span><span style="color:#bf616a;">decimal_places</span><span>=</span><span style="color:#d08770;">2</span><span>)
</span><span>    cost = models.</span><span style="color:#bf616a;">DecimalField</span><span>(</span><span style="color:#bf616a;">max_digits</span><span>=</span><span style="color:#d08770;">10</span><span>, </span><span style="color:#bf616a;">decimal_places</span><span>=</span><span style="color:#d08770;">2</span><span>)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">clean</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Model-level validation.&quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.price &lt; </span><span style="color:#bf616a;">self</span><span>.cost:
</span><span>            </span><span style="color:#b48ead;">raise </span><span style="color:#bf616a;">ValidationError</span><span>({
</span><span>                &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">Price cannot be less than cost</span><span>&#39;
</span><span>            })
</span><span>        
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.price &lt; </span><span style="color:#d08770;">0</span><span>:
</span><span>            </span><span style="color:#b48ead;">raise </span><span style="color:#bf616a;">ValidationError</span><span>(&#39;</span><span style="color:#a3be8c;">Price must be positive</span><span>&#39;)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">save</span><span>(</span><span style="color:#bf616a;">self</span><span>, *</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">kwargs</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Call clean before saving.&quot;&quot;&quot;
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">full_clean</span><span>()
</span><span>        </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">save</span><span>(*args, **kwargs)
</span></code></pre>
<h3 id="signals-use-sparingly">Signals - Use Sparingly</h3>
<p>Signals can create hidden dependencies. Use them wisely:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.db.models.signals </span><span style="color:#b48ead;">import </span><span>post_save, pre_delete
</span><span style="color:#b48ead;">from </span><span>django.dispatch </span><span style="color:#b48ead;">import </span><span>receiver
</span><span>
</span><span>@</span><span style="color:#bf616a;">receiver</span><span>(post_save, </span><span style="color:#bf616a;">sender</span><span>=User)
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">create_user_profile</span><span>(</span><span style="color:#bf616a;">sender</span><span>, </span><span style="color:#bf616a;">instance</span><span>, </span><span style="color:#bf616a;">created</span><span>, **</span><span style="color:#bf616a;">kwargs</span><span>):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Create profile when user is created.&quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">if </span><span>created:
</span><span>        Profile.objects.</span><span style="color:#bf616a;">create</span><span>(</span><span style="color:#bf616a;">user</span><span>=instance)
</span><span>
</span><span>@</span><span style="color:#bf616a;">receiver</span><span>(pre_delete, </span><span style="color:#bf616a;">sender</span><span>=Order)
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">restore_stock</span><span>(</span><span style="color:#bf616a;">sender</span><span>, </span><span style="color:#bf616a;">instance</span><span>, **</span><span style="color:#bf616a;">kwargs</span><span>):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Restore product stock when order is deleted.&quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">for </span><span>item </span><span style="color:#b48ead;">in </span><span>instance.items.</span><span style="color:#bf616a;">all</span><span>():
</span><span>        item.product.stock += item.quantity
</span><span>        item.product.</span><span style="color:#bf616a;">save</span><span>()
</span></code></pre>
<p><strong>Professional Tip</strong>: Consider using model methods or service layers instead of signals when possible. Signals make code harder to trace and test.</p>
<h2 id="part-3-django-rest-framework-serializers">Part 3: Django REST Framework Serializers</h2>
<p>Serializers are the heart of DRF, converting complex data types to Python datatypes and vice versa.</p>
<h3 id="basic-serializers">Basic Serializers</h3>
<h4 id="modelserializer">ModelSerializer</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>serializers
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">created_at</span><span>&#39;]
</span><span>        read_only_fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">created_at</span><span>&#39;]
</span></code></pre>
<h4 id="explicit-field-definition">Explicit Field Definition</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.Serializer</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#96b5b4;">id </span><span>= serializers.</span><span style="color:#bf616a;">IntegerField</span><span>(</span><span style="color:#bf616a;">read_only</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    name = serializers.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">200</span><span>)
</span><span>    price = serializers.</span><span style="color:#bf616a;">DecimalField</span><span>(</span><span style="color:#bf616a;">max_digits</span><span>=</span><span style="color:#d08770;">10</span><span>, </span><span style="color:#bf616a;">decimal_places</span><span>=</span><span style="color:#d08770;">2</span><span>)
</span><span>    stock = serializers.</span><span style="color:#bf616a;">IntegerField</span><span>(</span><span style="color:#bf616a;">min_value</span><span>=</span><span style="color:#d08770;">0</span><span>)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">create</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">validated_data</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span>Product.objects.</span><span style="color:#bf616a;">create</span><span>(**validated_data)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">update</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">instance</span><span>, </span><span style="color:#bf616a;">validated_data</span><span>):
</span><span>        instance.name = validated_data.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, instance.name)
</span><span>        instance.price = validated_data.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, instance.price)
</span><span>        instance.stock = validated_data.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;, instance.stock)
</span><span>        instance.</span><span style="color:#bf616a;">save</span><span>()
</span><span>        </span><span style="color:#b48ead;">return </span><span>instance
</span></code></pre>
<h3 id="advanced-serializer-patterns">Advanced Serializer Patterns</h3>
<h4 id="nested-serializers">Nested Serializers</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">AuthorSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Author
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">email</span><span>&#39;]
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">BookSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    author = </span><span style="color:#bf616a;">AuthorSerializer</span><span>(</span><span style="color:#bf616a;">read_only</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    author_id = serializers.</span><span style="color:#bf616a;">IntegerField</span><span>(</span><span style="color:#bf616a;">write_only</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Book
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">title</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">author</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">author_id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">published_date</span><span>&#39;]
</span></code></pre>
<h4 id="serializermethodfield">SerializerMethodField</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">OrderSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    total_amount = serializers.</span><span style="color:#bf616a;">SerializerMethodField</span><span>()
</span><span>    customer_name = serializers.</span><span style="color:#bf616a;">SerializerMethodField</span><span>()
</span><span>    status_display = serializers.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">source</span><span>=&#39;</span><span style="color:#a3be8c;">get_status_display</span><span>&#39;, </span><span style="color:#bf616a;">read_only</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Order
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">customer_name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">status</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">status_display</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">total_amount</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_total_amount</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#96b5b4;">sum</span><span>(item.subtotal </span><span style="color:#b48ead;">for </span><span>item </span><span style="color:#b48ead;">in </span><span>obj.items.</span><span style="color:#bf616a;">all</span><span>())
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_customer_name</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span>obj.user.</span><span style="color:#bf616a;">get_full_name</span><span>()
</span></code></pre>
<h4 id="different-serializers-for-different-actions">Different Serializers for Different Actions</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductListSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Lightweight serializer for list views.&quot;&quot;&quot;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;]
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductDetailSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Detailed serializer with relationships.&quot;&quot;&quot;
</span><span>    category = </span><span style="color:#bf616a;">CategorySerializer</span><span>(</span><span style="color:#bf616a;">read_only</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    reviews = </span><span style="color:#bf616a;">ReviewSerializer</span><span>(</span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">read_only</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    average_rating = serializers.</span><span style="color:#bf616a;">SerializerMethodField</span><span>()
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [
</span><span>            &#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">description</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;,
</span><span>            &#39;</span><span style="color:#a3be8c;">category</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">reviews</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">average_rating</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">created_at</span><span>&#39;
</span><span>        ]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_average_rating</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span>obj.reviews.</span><span style="color:#bf616a;">aggregate</span><span>(</span><span style="color:#bf616a;">Avg</span><span>(&#39;</span><span style="color:#a3be8c;">rating</span><span>&#39;))[&#39;</span><span style="color:#a3be8c;">rating__avg</span><span>&#39;]
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductCreateSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Serializer optimized for creation.&quot;&quot;&quot;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">description</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">category_id</span><span>&#39;]
</span></code></pre>
<h4 id="dynamic-fields">Dynamic Fields</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">DynamicFieldsSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Serializer that allows dynamic field selection.&quot;&quot;&quot;
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__init__</span><span>(</span><span style="color:#bf616a;">self</span><span>, *</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">kwargs</span><span>):
</span><span>        </span><span style="color:#65737e;"># Extract fields parameter before passing to parent
</span><span>        fields = kwargs.</span><span style="color:#bf616a;">pop</span><span>(&#39;</span><span style="color:#a3be8c;">fields</span><span>&#39;, </span><span style="color:#d08770;">None</span><span>)
</span><span>        exclude = kwargs.</span><span style="color:#bf616a;">pop</span><span>(&#39;</span><span style="color:#a3be8c;">exclude</span><span>&#39;, </span><span style="color:#d08770;">None</span><span>)
</span><span>        
</span><span>        </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#96b5b4;">__init__</span><span>(*args, **kwargs)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">if </span><span>fields is not </span><span style="color:#d08770;">None</span><span>:
</span><span>            </span><span style="color:#65737e;"># Drop fields not specified
</span><span>            allowed = </span><span style="color:#bf616a;">set</span><span>(fields)
</span><span>            existing = </span><span style="color:#bf616a;">set</span><span>(</span><span style="color:#bf616a;">self</span><span>.fields)
</span><span>            </span><span style="color:#b48ead;">for </span><span>field_name </span><span style="color:#b48ead;">in </span><span>existing - allowed:
</span><span>                </span><span style="color:#bf616a;">self</span><span>.fields.</span><span style="color:#bf616a;">pop</span><span>(field_name)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">if </span><span>exclude is not </span><span style="color:#d08770;">None</span><span>:
</span><span>            </span><span style="color:#b48ead;">for </span><span>field_name </span><span style="color:#b48ead;">in </span><span>exclude:
</span><span>                </span><span style="color:#bf616a;">self</span><span>.fields.</span><span style="color:#bf616a;">pop</span><span>(field_name, </span><span style="color:#d08770;">None</span><span>)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">DynamicFieldsSerializer</span><span style="color:#eff1f5;">):
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span><span>
</span><span style="color:#65737e;"># Usage in view
</span><span>serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(products, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">fields</span><span>=[&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;])
</span></code></pre>
<h3 id="validation">Validation</h3>
<h4 id="field-level-validation">Field-Level Validation</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">cost</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">validate_price</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">value</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Validate individual field.&quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">if </span><span>value &lt;= </span><span style="color:#d08770;">0</span><span>:
</span><span>            </span><span style="color:#b48ead;">raise </span><span>serializers.</span><span style="color:#bf616a;">ValidationError</span><span>(&quot;</span><span style="color:#a3be8c;">Price must be positive</span><span>&quot;)
</span><span>        </span><span style="color:#b48ead;">if </span><span>value &gt; </span><span style="color:#d08770;">1000000</span><span>:
</span><span>            </span><span style="color:#b48ead;">raise </span><span>serializers.</span><span style="color:#bf616a;">ValidationError</span><span>(&quot;</span><span style="color:#a3be8c;">Price too high</span><span>&quot;)
</span><span>        </span><span style="color:#b48ead;">return </span><span>value
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">validate_name</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">value</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Check for duplicate names.&quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">if </span><span>Product.objects.</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">name__iexact</span><span>=value).</span><span style="color:#bf616a;">exists</span><span>():
</span><span>            </span><span style="color:#b48ead;">raise </span><span>serializers.</span><span style="color:#bf616a;">ValidationError</span><span>(&quot;</span><span style="color:#a3be8c;">Product with this name already exists</span><span>&quot;)
</span><span>        </span><span style="color:#b48ead;">return </span><span>value
</span></code></pre>
<h4 id="object-level-validation">Object-Level Validation</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">cost</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">validate</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">data</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Cross-field validation.&quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">if </span><span>data.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, </span><span style="color:#d08770;">0</span><span>) &lt; data.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">cost</span><span>&#39;, </span><span style="color:#d08770;">0</span><span>):
</span><span>            </span><span style="color:#b48ead;">raise </span><span>serializers.</span><span style="color:#bf616a;">ValidationError</span><span>({
</span><span>                &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">Price cannot be less than cost</span><span>&#39;
</span><span>            })
</span><span>        
</span><span>        </span><span style="color:#b48ead;">if </span><span>data.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;, </span><span style="color:#d08770;">0</span><span>) &lt; </span><span style="color:#d08770;">0</span><span>:
</span><span>            </span><span style="color:#b48ead;">raise </span><span>serializers.</span><span style="color:#bf616a;">ValidationError</span><span>({
</span><span>                &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">Stock cannot be negative</span><span>&#39;
</span><span>            })
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span>data
</span></code></pre>
<h4 id="custom-validators">Custom Validators</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">validate_future_date</span><span>(</span><span style="color:#bf616a;">value</span><span>):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Validator function for future dates.&quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">if </span><span>value &lt;= timezone.</span><span style="color:#bf616a;">now</span><span>().</span><span style="color:#bf616a;">date</span><span>():
</span><span>        </span><span style="color:#b48ead;">raise </span><span>serializers.</span><span style="color:#bf616a;">ValidationError</span><span>(&quot;</span><span style="color:#a3be8c;">Date must be in the future</span><span>&quot;)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EventSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    event_date = serializers.</span><span style="color:#bf616a;">DateField</span><span>(</span><span style="color:#bf616a;">validators</span><span>=[validate_future_date])
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Event
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">event_date</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">location</span><span>&#39;]
</span></code></pre>
<h3 id="handling-relationships">Handling Relationships</h3>
<h4 id="writable-nested-serializers">Writable Nested Serializers</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">OrderItemSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = OrderItem
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">product_id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">quantity</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;]
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">OrderSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    items = </span><span style="color:#bf616a;">OrderItemSerializer</span><span>(</span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Order
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">user</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">status</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">items</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">create</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">validated_data</span><span>):
</span><span>        items_data = validated_data.</span><span style="color:#bf616a;">pop</span><span>(&#39;</span><span style="color:#a3be8c;">items</span><span>&#39;)
</span><span>        order = Order.objects.</span><span style="color:#bf616a;">create</span><span>(**validated_data)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">for </span><span>item_data </span><span style="color:#b48ead;">in </span><span>items_data:
</span><span>            OrderItem.objects.</span><span style="color:#bf616a;">create</span><span>(</span><span style="color:#bf616a;">order</span><span>=order, **item_data)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span>order
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">update</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">instance</span><span>, </span><span style="color:#bf616a;">validated_data</span><span>):
</span><span>        items_data = validated_data.</span><span style="color:#bf616a;">pop</span><span>(&#39;</span><span style="color:#a3be8c;">items</span><span>&#39;, </span><span style="color:#d08770;">None</span><span>)
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Update order fields
</span><span>        instance.status = validated_data.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">status</span><span>&#39;, instance.status)
</span><span>        instance.</span><span style="color:#bf616a;">save</span><span>()
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Handle items update
</span><span>        </span><span style="color:#b48ead;">if </span><span>items_data is not </span><span style="color:#d08770;">None</span><span>:
</span><span>            </span><span style="color:#65737e;"># Remove existing items
</span><span>            instance.items.</span><span style="color:#bf616a;">all</span><span>().</span><span style="color:#bf616a;">delete</span><span>()
</span><span>            </span><span style="color:#65737e;"># Create new items
</span><span>            </span><span style="color:#b48ead;">for </span><span>item_data </span><span style="color:#b48ead;">in </span><span>items_data:
</span><span>                OrderItem.objects.</span><span style="color:#bf616a;">create</span><span>(</span><span style="color:#bf616a;">order</span><span>=instance, **item_data)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span>instance
</span></code></pre>
<h4 id="primarykeyrelatedfield-slugrelatedfield">PrimaryKeyRelatedField, SlugRelatedField</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">BookSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;"># Use author&#39;s ID
</span><span>    author_id = serializers.</span><span style="color:#bf616a;">PrimaryKeyRelatedField</span><span>(
</span><span>        </span><span style="color:#bf616a;">queryset</span><span>=Author.objects.</span><span style="color:#bf616a;">all</span><span>(),
</span><span>        </span><span style="color:#bf616a;">source</span><span>=&#39;</span><span style="color:#a3be8c;">author</span><span>&#39;
</span><span>    )
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Use author&#39;s slug
</span><span>    author_slug = serializers.</span><span style="color:#bf616a;">SlugRelatedField</span><span>(
</span><span>        </span><span style="color:#bf616a;">slug_field</span><span>=&#39;</span><span style="color:#a3be8c;">slug</span><span>&#39;,
</span><span>        </span><span style="color:#bf616a;">queryset</span><span>=Author.objects.</span><span style="color:#bf616a;">all</span><span>(),
</span><span>        </span><span style="color:#bf616a;">source</span><span>=&#39;</span><span style="color:#a3be8c;">author</span><span>&#39;
</span><span>    )
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Use custom string representation
</span><span>    author_name = serializers.</span><span style="color:#bf616a;">StringRelatedField</span><span>(</span><span style="color:#bf616a;">source</span><span>=&#39;</span><span style="color:#a3be8c;">author</span><span>&#39;)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Book
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">title</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">author_id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">author_slug</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">author_name</span><span>&#39;]
</span></code></pre>
<h4 id="hyperlinkedmodelserializer">HyperlinkedModelSerializer</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.HyperlinkedModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    category = serializers.</span><span style="color:#bf616a;">HyperlinkedRelatedField</span><span>(
</span><span>        </span><span style="color:#bf616a;">view_name</span><span>=&#39;</span><span style="color:#a3be8c;">category-detail</span><span>&#39;,
</span><span>        </span><span style="color:#bf616a;">read_only</span><span>=</span><span style="color:#d08770;">True
</span><span>    )
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">url</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">category</span><span>&#39;]
</span><span>        extra_kwargs = {
</span><span>            &#39;</span><span style="color:#a3be8c;">url</span><span>&#39;: {&#39;</span><span style="color:#a3be8c;">view_name</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">product-detail</span><span>&#39;}
</span><span>        }
</span></code></pre>
<h3 id="context-and-request-access">Context and Request Access</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    is_favorited = serializers.</span><span style="color:#bf616a;">SerializerMethodField</span><span>()
</span><span>    can_edit = serializers.</span><span style="color:#bf616a;">SerializerMethodField</span><span>()
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">is_favorited</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">can_edit</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_is_favorited</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        request = </span><span style="color:#bf616a;">self</span><span>.context.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">request</span><span>&#39;)
</span><span>        </span><span style="color:#b48ead;">if </span><span>request and request.user.is_authenticated:
</span><span>            </span><span style="color:#b48ead;">return </span><span>obj.favorited_by.</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">id</span><span>=request.user.id).</span><span style="color:#bf616a;">exists</span><span>()
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">False
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_can_edit</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        request = </span><span style="color:#bf616a;">self</span><span>.context.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">request</span><span>&#39;)
</span><span>        </span><span style="color:#b48ead;">if </span><span>request and request.user.is_authenticated:
</span><span>            </span><span style="color:#b48ead;">return </span><span>request.user.</span><span style="color:#bf616a;">has_perm</span><span>(&#39;</span><span style="color:#a3be8c;">products.change_product</span><span>&#39;)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">False
</span><span>
</span><span style="color:#65737e;"># In view, pass context
</span><span>serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(product, </span><span style="color:#bf616a;">context</span><span>={&#39;</span><span style="color:#a3be8c;">request</span><span>&#39;: request})
</span></code></pre>
<h3 id="performance-optimization">Performance Optimization</h3>
<h4 id="to-representation-optimization">to_representation Optimization</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">OptimizedOrderSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    items = </span><span style="color:#bf616a;">OrderItemSerializer</span><span>(</span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">read_only</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Order
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">id</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">user</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">status</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">items</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">total</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">to_representation</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">instance</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Optimize by prefetching related data.&quot;&quot;&quot;
</span><span>        </span><span style="color:#65737e;"># This runs once for the queryset, not per instance
</span><span>        </span><span style="color:#bf616a;">self</span><span>.fields[&#39;</span><span style="color:#a3be8c;">items</span><span>&#39;].child.context[&#39;</span><span style="color:#a3be8c;">products</span><span>&#39;] = {
</span><span>            p.id: p </span><span style="color:#b48ead;">for </span><span>p </span><span style="color:#b48ead;">in </span><span>Product.objects.</span><span style="color:#bf616a;">filter</span><span>(
</span><span>                </span><span style="color:#bf616a;">id__in</span><span>=instance.items.</span><span style="color:#bf616a;">values_list</span><span>(&#39;</span><span style="color:#a3be8c;">product_id</span><span>&#39;, </span><span style="color:#bf616a;">flat</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>            )
</span><span>        }
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">to_representation</span><span>(instance)
</span></code></pre>
<h2 id="part-4-views-and-viewsets">Part 4: Views and ViewSets</h2>
<h3 id="function-based-views-fbv">Function-Based Views (FBV)</h3>
<p>While class-based views are more common in DRF, FBVs have their place:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.decorators </span><span style="color:#b48ead;">import </span><span>api_view, permission_classes
</span><span style="color:#b48ead;">from </span><span>rest_framework.response </span><span style="color:#b48ead;">import </span><span>Response
</span><span style="color:#b48ead;">from </span><span>rest_framework.permissions </span><span style="color:#b48ead;">import </span><span>IsAuthenticated
</span><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>status
</span><span>
</span><span>@</span><span style="color:#bf616a;">api_view</span><span>([&#39;</span><span style="color:#a3be8c;">GET</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">POST</span><span>&#39;])
</span><span>@</span><span style="color:#bf616a;">permission_classes</span><span>([IsAuthenticated])
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">product_list</span><span>(</span><span style="color:#bf616a;">request</span><span>):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;List products or create new product.&quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">if </span><span>request.method == &#39;</span><span style="color:#a3be8c;">GET</span><span>&#39;:
</span><span>        products = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(products, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">elif </span><span>request.method == &#39;</span><span style="color:#a3be8c;">POST</span><span>&#39;:
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(</span><span style="color:#bf616a;">data</span><span>=request.data)
</span><span>        </span><span style="color:#b48ead;">if </span><span>serializer.</span><span style="color:#bf616a;">is_valid</span><span>():
</span><span>            serializer.</span><span style="color:#bf616a;">save</span><span>()
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data, </span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_201_CREATED</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.errors, </span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_400_BAD_REQUEST</span><span>)
</span><span>
</span><span>@</span><span style="color:#bf616a;">api_view</span><span>([&#39;</span><span style="color:#a3be8c;">GET</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">PUT</span><span>&#39;, &#39;</span><span style="color:#b48ead;">DELETE</span><span>&#39;])
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">product_detail</span><span>(</span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Retrieve, update or delete a product.&quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">try</span><span>:
</span><span>        product = Product.objects.</span><span style="color:#bf616a;">get</span><span>(</span><span style="color:#bf616a;">pk</span><span>=pk)
</span><span>    </span><span style="color:#b48ead;">except </span><span>Product.DoesNotExist:
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(</span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_404_NOT_FOUND</span><span>)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">if </span><span>request.method == &#39;</span><span style="color:#a3be8c;">GET</span><span>&#39;:
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(product)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">elif </span><span>request.method == &#39;</span><span style="color:#a3be8c;">PUT</span><span>&#39;:
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(product, </span><span style="color:#bf616a;">data</span><span>=request.data)
</span><span>        </span><span style="color:#b48ead;">if </span><span>serializer.</span><span style="color:#bf616a;">is_valid</span><span>():
</span><span>            serializer.</span><span style="color:#bf616a;">save</span><span>()
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.errors, </span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_400_BAD_REQUEST</span><span>)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">elif </span><span>request.method == &#39;</span><span style="color:#b48ead;">DELETE</span><span>&#39;:
</span><span>        product.</span><span style="color:#bf616a;">delete</span><span>()
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(</span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_204_NO_CONTENT</span><span>)
</span></code></pre>
<h3 id="apiview-class-based-views">APIView - Class-Based Views</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.views </span><span style="color:#b48ead;">import </span><span>APIView
</span><span style="color:#b48ead;">from </span><span>rest_framework.response </span><span style="color:#b48ead;">import </span><span>Response
</span><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>status
</span><span style="color:#b48ead;">from </span><span>django.shortcuts </span><span style="color:#b48ead;">import </span><span>get_object_or_404
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductListView</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">APIView</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    List all products or create a new product.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    permission_classes = [IsAuthenticated]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>):
</span><span>        products = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Filtering
</span><span>        category = request.query_params.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;)
</span><span>        </span><span style="color:#b48ead;">if </span><span>category:
</span><span>            products = products.</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">category</span><span>=category)
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Ordering
</span><span>        ordering = request.query_params.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">ordering</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">-created_at</span><span>&#39;)
</span><span>        products = products.</span><span style="color:#bf616a;">order_by</span><span>(ordering)
</span><span>        
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(products, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">context</span><span>={&#39;</span><span style="color:#a3be8c;">request</span><span>&#39;: request})
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">post</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>):
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(</span><span style="color:#bf616a;">data</span><span>=request.data)
</span><span>        </span><span style="color:#b48ead;">if </span><span>serializer.</span><span style="color:#bf616a;">is_valid</span><span>():
</span><span>            serializer.</span><span style="color:#bf616a;">save</span><span>(</span><span style="color:#bf616a;">created_by</span><span>=request.user)
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data, </span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_201_CREATED</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.errors, </span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_400_BAD_REQUEST</span><span>)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductDetailView</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">APIView</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    Retrieve, update or delete a product instance.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_object</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">pk</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">get_object_or_404</span><span>(Product, </span><span style="color:#bf616a;">pk</span><span>=pk)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>):
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>(pk)
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(product)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">put</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>):
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>(pk)
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(product, </span><span style="color:#bf616a;">data</span><span>=request.data)
</span><span>        </span><span style="color:#b48ead;">if </span><span>serializer.</span><span style="color:#bf616a;">is_valid</span><span>():
</span><span>            serializer.</span><span style="color:#bf616a;">save</span><span>()
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.errors, </span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_400_BAD_REQUEST</span><span>)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">patch</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>):
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>(pk)
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(product, </span><span style="color:#bf616a;">data</span><span>=request.data, </span><span style="color:#bf616a;">partial</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        </span><span style="color:#b48ead;">if </span><span>serializer.</span><span style="color:#bf616a;">is_valid</span><span>():
</span><span>            serializer.</span><span style="color:#bf616a;">save</span><span>()
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.errors, </span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_400_BAD_REQUEST</span><span>)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">delete</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>):
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>(pk)
</span><span>        product.</span><span style="color:#bf616a;">delete</span><span>()
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(</span><span style="color:#bf616a;">status</span><span>=status.</span><span style="color:#bf616a;">HTTP_204_NO_CONTENT</span><span>)
</span></code></pre>
<h3 id="generic-views">Generic Views</h3>
<p>Generic views provide common patterns:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>generics
</span><span style="color:#b48ead;">from </span><span>rest_framework.permissions </span><span style="color:#b48ead;">import </span><span>IsAuthenticatedOrReadOnly
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductListView</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">generics.ListCreateAPIView</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;List and create products.&quot;&quot;&quot;
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    permission_classes = [IsAuthenticatedOrReadOnly]
</span><span>    filterset_fields = [&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;]
</span><span>    search_fields = [&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">description</span><span>&#39;]
</span><span>    ordering_fields = [&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">created_at</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">perform_create</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">serializer</span><span>):
</span><span>        serializer.</span><span style="color:#bf616a;">save</span><span>(</span><span style="color:#bf616a;">created_by</span><span>=</span><span style="color:#bf616a;">self</span><span>.request.user)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductDetailView</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">generics.RetrieveUpdateDestroyAPIView</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Retrieve, update, or delete a product.&quot;&quot;&quot;
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    permission_classes = [IsAuthenticatedOrReadOnly]
</span></code></pre>
<h4 id="all-generic-view-classes">All Generic View Classes</h4>
<ul>
<li><code>CreateAPIView</code> - POST only</li>
<li><code>ListAPIView</code> - GET list only</li>
<li><code>RetrieveAPIView</code> - GET single object only</li>
<li><code>DestroyAPIView</code> - DELETE only</li>
<li><code>UpdateAPIView</code> - PUT/PATCH only</li>
<li><code>ListCreateAPIView</code> - GET list, POST</li>
<li><code>RetrieveUpdateAPIView</code> - GET, PUT, PATCH</li>
<li><code>RetrieveDestroyAPIView</code> - GET, DELETE</li>
<li><code>RetrieveUpdateDestroyAPIView</code> - GET, PUT, PATCH, DELETE</li>
</ul>
<h3 id="viewsets-the-professional-choice">ViewSets - The Professional Choice</h3>
<p>ViewSets combine logic for multiple related views:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>viewsets
</span><span style="color:#b48ead;">from </span><span>rest_framework.decorators </span><span style="color:#b48ead;">import </span><span>action
</span><span style="color:#b48ead;">from </span><span>rest_framework.response </span><span style="color:#b48ead;">import </span><span>Response
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    ViewSet for viewing and editing products.
</span><span style="color:#65737e;">    
</span><span style="color:#65737e;">    Automatically provides:
</span><span style="color:#65737e;">    - list: GET /products/
</span><span style="color:#65737e;">    - create: POST /products/
</span><span style="color:#65737e;">    - retrieve: GET /products/{id}/
</span><span style="color:#65737e;">    - update: PUT /products/{id}/
</span><span style="color:#65737e;">    - partial_update: PATCH /products/{id}/
</span><span style="color:#65737e;">    - destroy: DELETE /products/{id}/
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    permission_classes = [IsAuthenticatedOrReadOnly]
</span><span>    filterset_fields = [&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;]
</span><span>    search_fields = [&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">description</span><span>&#39;]
</span><span>    ordering_fields = [&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">created_at</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_queryset</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Customize queryset based on action.&quot;&quot;&quot;
</span><span>        queryset = </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">get_queryset</span><span>()
</span><span>        
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.action == &#39;</span><span style="color:#a3be8c;">list</span><span>&#39;:
</span><span>            </span><span style="color:#65737e;"># Optimize list queries
</span><span>            queryset = queryset.</span><span style="color:#bf616a;">select_related</span><span>(&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;)
</span><span>        </span><span style="color:#b48ead;">elif </span><span style="color:#bf616a;">self</span><span>.action == &#39;</span><span style="color:#a3be8c;">retrieve</span><span>&#39;:
</span><span>            </span><span style="color:#65737e;"># Optimize detail queries
</span><span>            queryset = queryset.</span><span style="color:#bf616a;">prefetch_related</span><span>(&#39;</span><span style="color:#a3be8c;">reviews</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">reviews__user</span><span>&#39;)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span>queryset
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_serializer_class</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Use different serializers for different actions.&quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.action == &#39;</span><span style="color:#a3be8c;">list</span><span>&#39;:
</span><span>            </span><span style="color:#b48ead;">return </span><span>ProductListSerializer
</span><span>        </span><span style="color:#b48ead;">elif </span><span style="color:#bf616a;">self</span><span>.action == &#39;</span><span style="color:#a3be8c;">retrieve</span><span>&#39;:
</span><span>            </span><span style="color:#b48ead;">return </span><span>ProductDetailSerializer
</span><span>        </span><span style="color:#b48ead;">return </span><span>ProductSerializer
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">perform_create</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">serializer</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Hook called before saving.&quot;&quot;&quot;
</span><span>        serializer.</span><span style="color:#bf616a;">save</span><span>(</span><span style="color:#bf616a;">created_by</span><span>=</span><span style="color:#bf616a;">self</span><span>.request.user)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">perform_update</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">serializer</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Hook called before updating.&quot;&quot;&quot;
</span><span>        serializer.</span><span style="color:#bf616a;">save</span><span>(</span><span style="color:#bf616a;">updated_by</span><span>=</span><span style="color:#bf616a;">self</span><span>.request.user)
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Custom actions
</span><span>    @</span><span style="color:#bf616a;">action</span><span>(</span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">methods</span><span>=[&#39;</span><span style="color:#a3be8c;">post</span><span>&#39;])
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">favorite</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>=</span><span style="color:#d08770;">None</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Mark product as favorite.&quot;&quot;&quot;
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>()
</span><span>        request.user.favorites.</span><span style="color:#bf616a;">add</span><span>(product)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>({&#39;</span><span style="color:#a3be8c;">status</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">product favorited</span><span>&#39;})
</span><span>    
</span><span>    @</span><span style="color:#bf616a;">action</span><span>(</span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">methods</span><span>=[&#39;</span><span style="color:#a3be8c;">post</span><span>&#39;])
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">unfavorite</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>=</span><span style="color:#d08770;">None</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Remove product from favorites.&quot;&quot;&quot;
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>()
</span><span>        request.user.favorites.</span><span style="color:#bf616a;">remove</span><span>(product)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>({&#39;</span><span style="color:#a3be8c;">status</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">product unfavorited</span><span>&#39;})
</span><span>    
</span><span>    @</span><span style="color:#bf616a;">action</span><span>(</span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">False</span><span>, </span><span style="color:#bf616a;">methods</span><span>=[&#39;</span><span style="color:#a3be8c;">get</span><span>&#39;])
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">featured</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Get featured products.&quot;&quot;&quot;
</span><span>        featured = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_queryset</span><span>().</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">is_featured</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        serializer = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_serializer</span><span>(featured, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>    
</span><span>    @</span><span style="color:#bf616a;">action</span><span>(</span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">methods</span><span>=[&#39;</span><span style="color:#a3be8c;">get</span><span>&#39;])
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">reviews</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>=</span><span style="color:#d08770;">None</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Get product reviews.&quot;&quot;&quot;
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>()
</span><span>        reviews = product.reviews.</span><span style="color:#bf616a;">all</span><span>()
</span><span>        serializer = </span><span style="color:#bf616a;">ReviewSerializer</span><span>(reviews, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span></code></pre>
<h4 id="readonlymodelviewset">ReadOnlyModelViewSet</h4>
<p>For read-only endpoints:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CategoryViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ReadOnlyModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    ViewSet that only provides list and retrieve actions.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    queryset = Category.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = CategorySerializer
</span></code></pre>
<h4 id="custom-viewset">Custom ViewSet</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>viewsets, mixins
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CreateListRetrieveViewSet</span><span style="color:#eff1f5;">(
</span><span style="color:#eff1f5;">    </span><span style="color:#a3be8c;">mixins.CreateModelMixin</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">    </span><span style="color:#a3be8c;">mixins.ListModelMixin</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">    </span><span style="color:#a3be8c;">mixins.RetrieveModelMixin</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">    </span><span style="color:#a3be8c;">viewsets.GenericViewSet
</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    ViewSet that provides create, list, and retrieve actions.
</span><span style="color:#65737e;">    No update or delete.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">pass
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">CreateListRetrieveViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span></code></pre>
<h3 id="pagination">Pagination</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.pagination </span><span style="color:#b48ead;">import </span><span>PageNumberPagination, LimitOffsetPagination, CursorPagination
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">StandardResultsSetPagination</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">PageNumberPagination</span><span style="color:#eff1f5;">):
</span><span>    page_size = </span><span style="color:#d08770;">20
</span><span>    page_size_query_param = &#39;</span><span style="color:#a3be8c;">page_size</span><span>&#39;
</span><span>    max_page_size = </span><span style="color:#d08770;">100
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    pagination_class = StandardResultsSetPagination
</span><span>
</span><span style="color:#65737e;"># In settings.py
</span><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_PAGINATION_CLASS</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">rest_framework.pagination.PageNumberPagination</span><span>&#39;,
</span><span>    &#39;</span><span style="color:#a3be8c;">PAGE_SIZE</span><span>&#39;: </span><span style="color:#d08770;">20
</span><span>}
</span></code></pre>
<h4 id="cursor-pagination-for-better-performance">Cursor Pagination for Better Performance</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductCursorPagination</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">CursorPagination</span><span style="color:#eff1f5;">):
</span><span>    page_size = </span><span style="color:#d08770;">20
</span><span>    ordering = &#39;</span><span style="color:#a3be8c;">-created_at</span><span>&#39;  </span><span style="color:#65737e;"># Must have ordering
</span><span>    cursor_query_param = &#39;</span><span style="color:#a3be8c;">cursor</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    pagination_class = ProductCursorPagination
</span></code></pre>
<h3 id="filtering-searching-ordering">Filtering, Searching, Ordering</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django_filters.rest_framework </span><span style="color:#b48ead;">import </span><span>DjangoFilterBackend
</span><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>filters
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    filter_backends = [
</span><span>        DjangoFilterBackend,
</span><span>        filters.SearchFilter,
</span><span>        filters.OrderingFilter
</span><span>    ]
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Simple filtering
</span><span>    filterset_fields = [&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">stock</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Search
</span><span>    search_fields = [&#39;</span><span style="color:#a3be8c;">name</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">description</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">category__name</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Ordering
</span><span>    ordering_fields = [&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">created_at</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;]
</span><span>    ordering = [&#39;</span><span style="color:#a3be8c;">-created_at</span><span>&#39;]  </span><span style="color:#65737e;"># Default ordering
</span></code></pre>
<h4 id="custom-filters">Custom Filters</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>django_filters
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductFilter</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">django_filters.FilterSet</span><span style="color:#eff1f5;">):
</span><span>    min_price = django_filters.</span><span style="color:#bf616a;">NumberFilter</span><span>(</span><span style="color:#bf616a;">field_name</span><span>=&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, </span><span style="color:#bf616a;">lookup_expr</span><span>=&#39;</span><span style="color:#a3be8c;">gte</span><span>&#39;)
</span><span>    max_price = django_filters.</span><span style="color:#bf616a;">NumberFilter</span><span>(</span><span style="color:#bf616a;">field_name</span><span>=&#39;</span><span style="color:#a3be8c;">price</span><span>&#39;, </span><span style="color:#bf616a;">lookup_expr</span><span>=&#39;</span><span style="color:#a3be8c;">lte</span><span>&#39;)
</span><span>    name = django_filters.</span><span style="color:#bf616a;">CharFilter</span><span>(</span><span style="color:#bf616a;">lookup_expr</span><span>=&#39;</span><span style="color:#a3be8c;">icontains</span><span>&#39;)
</span><span>    in_stock = django_filters.</span><span style="color:#bf616a;">BooleanFilter</span><span>(</span><span style="color:#bf616a;">method</span><span>=&#39;</span><span style="color:#a3be8c;">filter_in_stock</span><span>&#39;)
</span><span>    
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Product
</span><span>        fields = [&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">filter_in_stock</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">queryset</span><span>, </span><span style="color:#bf616a;">name</span><span>, </span><span style="color:#bf616a;">value</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span>value:
</span><span>            </span><span style="color:#b48ead;">return </span><span>queryset.</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">stock__gt</span><span>=</span><span style="color:#d08770;">0</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span>queryset.</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">stock</span><span>=</span><span style="color:#d08770;">0</span><span>)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    filterset_class = ProductFilter
</span></code></pre>
<h3 id="throttling">Throttling</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.throttling </span><span style="color:#b48ead;">import </span><span>UserRateThrottle, AnonRateThrottle
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">BurstRateThrottle</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">UserRateThrottle</span><span style="color:#eff1f5;">):
</span><span>    rate = &#39;</span><span style="color:#a3be8c;">60/min</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">SustainedRateThrottle</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">UserRateThrottle</span><span style="color:#eff1f5;">):
</span><span>    rate = &#39;</span><span style="color:#a3be8c;">1000/day</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    throttle_classes = [BurstRateThrottle, SustainedRateThrottle]
</span><span>
</span><span style="color:#65737e;"># In settings.py
</span><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_THROTTLE_CLASSES</span><span>&#39;: [
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework.throttling.AnonRateThrottle</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework.throttling.UserRateThrottle</span><span>&#39;
</span><span>    ],
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_THROTTLE_RATES</span><span>&#39;: {
</span><span>        &#39;</span><span style="color:#a3be8c;">anon</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">100/day</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">user</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">1000/day</span><span>&#39;
</span><span>    }
</span><span>}
</span></code></pre>
<h3 id="exception-handling">Exception Handling</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.views </span><span style="color:#b48ead;">import </span><span>exception_handler
</span><span style="color:#b48ead;">from </span><span>rest_framework.response </span><span style="color:#b48ead;">import </span><span>Response
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">custom_exception_handler</span><span>(</span><span style="color:#bf616a;">exc</span><span>, </span><span style="color:#bf616a;">context</span><span>):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Custom exception handler.&quot;&quot;&quot;
</span><span>    response = </span><span style="color:#bf616a;">exception_handler</span><span>(exc, context)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">if </span><span>response is not </span><span style="color:#d08770;">None</span><span>:
</span><span>        </span><span style="color:#65737e;"># Add custom error format
</span><span>        custom_response = {
</span><span>            &#39;</span><span style="color:#a3be8c;">error</span><span>&#39;: {
</span><span>                &#39;</span><span style="color:#a3be8c;">status_code</span><span>&#39;: response.status_code,
</span><span>                &#39;</span><span style="color:#a3be8c;">message</span><span>&#39;: response.data,
</span><span>                &#39;</span><span style="color:#a3be8c;">detail</span><span>&#39;: </span><span style="color:#bf616a;">str</span><span>(exc)
</span><span>            }
</span><span>        }
</span><span>        response.data = custom_response
</span><span>    
</span><span>    </span><span style="color:#b48ead;">return </span><span>response
</span><span>
</span><span style="color:#65737e;"># In settings.py
</span><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">EXCEPTION_HANDLER</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">myapp.utils.custom_exception_handler</span><span>&#39;
</span><span>}
</span></code></pre>
<h4 id="raising-custom-exceptions">Raising Custom Exceptions</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.exceptions </span><span style="color:#b48ead;">import </span><span>APIException
</span><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>status
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ServiceUnavailable</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">APIException</span><span style="color:#eff1f5;">):
</span><span>    status_code = status.</span><span style="color:#bf616a;">HTTP_503_SERVICE_UNAVAILABLE
</span><span>    default_detail = &#39;</span><span style="color:#a3be8c;">Service temporarily unavailable, try again later.</span><span>&#39;
</span><span>    default_code = &#39;</span><span style="color:#a3be8c;">service_unavailable</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">InsufficientStock</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">APIException</span><span style="color:#eff1f5;">):
</span><span>    status_code = status.</span><span style="color:#bf616a;">HTTP_400_BAD_REQUEST
</span><span>    default_detail = &#39;</span><span style="color:#a3be8c;">Not enough stock available.</span><span>&#39;
</span><span>    default_code = &#39;</span><span style="color:#a3be8c;">insufficient_stock</span><span>&#39;
</span><span>
</span><span style="color:#65737e;"># In view
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">create_order</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>):
</span><span>    product = Product.objects.</span><span style="color:#bf616a;">get</span><span>(</span><span style="color:#bf616a;">id</span><span>=request.data[&#39;</span><span style="color:#a3be8c;">product_id</span><span>&#39;])
</span><span>    quantity = request.data[&#39;</span><span style="color:#a3be8c;">quantity</span><span>&#39;]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">if </span><span>product.stock &lt; quantity:
</span><span>        </span><span style="color:#b48ead;">raise </span><span style="color:#bf616a;">InsufficientStock</span><span>({
</span><span>            &#39;</span><span style="color:#a3be8c;">available</span><span>&#39;: product.stock,
</span><span>            &#39;</span><span style="color:#a3be8c;">requested</span><span>&#39;: quantity
</span><span>        })
</span></code></pre>
<h2 id="part-5-routers">Part 5: Routers</h2>
<p>Routers automatically generate URL patterns for ViewSets.</p>
<h3 id="simple-router">Simple Router</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.routers </span><span style="color:#b48ead;">import </span><span>SimpleRouter
</span><span>
</span><span>router = </span><span style="color:#bf616a;">SimpleRouter</span><span>()
</span><span>router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">products</span><span>&#39;, ProductViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">product</span><span>&#39;)
</span><span>router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">categories</span><span>&#39;, CategoryViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;)
</span><span>
</span><span>urlpatterns = router.urls
</span></code></pre>
<h3 id="default-router-with-api-root">Default Router (with API Root)</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.routers </span><span style="color:#b48ead;">import </span><span>DefaultRouter
</span><span>
</span><span>router = </span><span style="color:#bf616a;">DefaultRouter</span><span>()
</span><span>router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">products</span><span>&#39;, ProductViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">product</span><span>&#39;)
</span><span>router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">categories</span><span>&#39;, CategoryViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">category</span><span>&#39;)
</span><span>router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">orders</span><span>&#39;, OrderViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">order</span><span>&#39;)
</span><span>
</span><span style="color:#65737e;"># URLs generated:
</span><span style="color:#65737e;"># GET /products/ - list
</span><span style="color:#65737e;"># POST /products/ - create
</span><span style="color:#65737e;"># GET /products/{id}/ - retrieve
</span><span style="color:#65737e;"># PUT /products/{id}/ - update
</span><span style="color:#65737e;"># PATCH /products/{id}/ - partial_update
</span><span style="color:#65737e;"># DELETE /products/{id}/ - destroy
</span><span style="color:#65737e;"># GET / - api root (DefaultRouter only)
</span><span>
</span><span>urlpatterns = [
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/</span><span>&#39;, </span><span style="color:#bf616a;">include</span><span>(router.urls)),
</span><span>]
</span></code></pre>
<h3 id="custom-actions-and-routes">Custom Actions and Routes</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    
</span><span>    </span><span style="color:#65737e;"># detail=True means URL includes {id}
</span><span>    </span><span style="color:#65737e;"># URL: /products/{id}/favorite/
</span><span>    @</span><span style="color:#bf616a;">action</span><span>(</span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">methods</span><span>=[&#39;</span><span style="color:#a3be8c;">post</span><span>&#39;], </span><span style="color:#bf616a;">url_path</span><span>=&#39;</span><span style="color:#a3be8c;">favorite</span><span>&#39;)
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">mark_favorite</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>=</span><span style="color:#d08770;">None</span><span>):
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>()
</span><span>        request.user.favorites.</span><span style="color:#bf616a;">add</span><span>(product)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>({&#39;</span><span style="color:#a3be8c;">status</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">favorited</span><span>&#39;})
</span><span>    
</span><span>    </span><span style="color:#65737e;"># detail=False means no {id} in URL
</span><span>    </span><span style="color:#65737e;"># URL: /products/featured/
</span><span>    @</span><span style="color:#bf616a;">action</span><span>(</span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">False</span><span>, </span><span style="color:#bf616a;">methods</span><span>=[&#39;</span><span style="color:#a3be8c;">get</span><span>&#39;])
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">featured</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>):
</span><span>        featured = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_queryset</span><span>().</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">is_featured</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        serializer = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_serializer</span><span>(featured, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>    
</span><span>    </span><span style="color:#65737e;"># Custom URL path and name
</span><span>    @</span><span style="color:#bf616a;">action</span><span>(
</span><span>        </span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">True</span><span>,
</span><span>        </span><span style="color:#bf616a;">methods</span><span>=[&#39;</span><span style="color:#a3be8c;">post</span><span>&#39;],
</span><span>        </span><span style="color:#bf616a;">url_path</span><span>=&#39;</span><span style="color:#a3be8c;">add-review</span><span>&#39;,
</span><span>        </span><span style="color:#bf616a;">url_name</span><span>=&#39;</span><span style="color:#a3be8c;">add-review</span><span>&#39;
</span><span>    )
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">add_review</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">pk</span><span>=</span><span style="color:#d08770;">None</span><span>):
</span><span>        product = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_object</span><span>()
</span><span>        serializer = </span><span style="color:#bf616a;">ReviewSerializer</span><span>(</span><span style="color:#bf616a;">data</span><span>=request.data)
</span><span>        </span><span style="color:#b48ead;">if </span><span>serializer.</span><span style="color:#bf616a;">is_valid</span><span>():
</span><span>            serializer.</span><span style="color:#bf616a;">save</span><span>(</span><span style="color:#bf616a;">product</span><span>=product, </span><span style="color:#bf616a;">user</span><span>=request.user)
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data, </span><span style="color:#bf616a;">status</span><span>=</span><span style="color:#d08770;">201</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.errors, </span><span style="color:#bf616a;">status</span><span>=</span><span style="color:#d08770;">400</span><span>)
</span></code></pre>
<h3 id="nested-routers">Nested Routers</h3>
<p>For nested resources, use <code>drf-nested-routers</code>:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework_nested </span><span style="color:#b48ead;">import </span><span>routers
</span><span>
</span><span>router = routers.</span><span style="color:#bf616a;">SimpleRouter</span><span>()
</span><span>router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">authors</span><span>&#39;, AuthorViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">author</span><span>&#39;)
</span><span>router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">publishers</span><span>&#39;, PublisherViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">publisher</span><span>&#39;)
</span><span>
</span><span style="color:#65737e;"># Nested router for author&#39;s books
</span><span>authors_router = routers.</span><span style="color:#bf616a;">NestedSimpleRouter</span><span>(router, </span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">authors</span><span>&#39;, </span><span style="color:#bf616a;">lookup</span><span>=&#39;</span><span style="color:#a3be8c;">author</span><span>&#39;)
</span><span>authors_router.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">books</span><span>&#39;, BookViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">author-books</span><span>&#39;)
</span><span>
</span><span style="color:#65737e;"># URLs generated:
</span><span style="color:#65737e;"># /authors/ - list authors
</span><span style="color:#65737e;"># /authors/{author_pk}/ - author detail
</span><span style="color:#65737e;"># /authors/{author_pk}/books/ - author&#39;s books list
</span><span style="color:#65737e;"># /authors/{author_pk}/books/{id}/ - specific book
</span><span>
</span><span>urlpatterns = [
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/</span><span>&#39;, </span><span style="color:#bf616a;">include</span><span>(router.urls)),
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/</span><span>&#39;, </span><span style="color:#bf616a;">include</span><span>(authors_router.urls)),
</span><span>]
</span></code></pre>
<h3 id="custom-router-configuration">Custom Router Configuration</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.routers </span><span style="color:#b48ead;">import </span><span>Route, DynamicRoute, SimpleRouter
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CustomRouter</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">SimpleRouter</span><span style="color:#eff1f5;">):
</span><span>    routes = [
</span><span>        </span><span style="color:#65737e;"># List route
</span><span>        </span><span style="color:#bf616a;">Route</span><span>(
</span><span>            </span><span style="color:#bf616a;">url</span><span>=</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#b48ead;">^</span><span style="color:#a3be8c;">{prefix}{trailing_slash}</span><span style="color:#b48ead;">$</span><span>&#39;,
</span><span>            </span><span style="color:#bf616a;">mapping</span><span>={&#39;</span><span style="color:#a3be8c;">get</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">list</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">post</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">create</span><span>&#39;},
</span><span>            </span><span style="color:#bf616a;">name</span><span>=&#39;</span><span style="color:#d08770;">{basename}</span><span style="color:#a3be8c;">-list</span><span>&#39;,
</span><span>            </span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">False</span><span>,
</span><span>            </span><span style="color:#bf616a;">initkwargs</span><span>={&#39;</span><span style="color:#a3be8c;">suffix</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">List</span><span>&#39;}
</span><span>        ),
</span><span>        </span><span style="color:#65737e;"># Detail route
</span><span>        </span><span style="color:#bf616a;">Route</span><span>(
</span><span>            </span><span style="color:#bf616a;">url</span><span>=</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#b48ead;">^</span><span style="color:#a3be8c;">{prefix}/{lookup}{trailing_slash}</span><span style="color:#b48ead;">$</span><span>&#39;,
</span><span>            </span><span style="color:#bf616a;">mapping</span><span>={
</span><span>                &#39;</span><span style="color:#a3be8c;">get</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">retrieve</span><span>&#39;,
</span><span>                &#39;</span><span style="color:#a3be8c;">put</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">update</span><span>&#39;,
</span><span>                &#39;</span><span style="color:#a3be8c;">patch</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">partial_update</span><span>&#39;,
</span><span>                &#39;</span><span style="color:#a3be8c;">delete</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">destroy</span><span>&#39;
</span><span>            },
</span><span>            </span><span style="color:#bf616a;">name</span><span>=&#39;</span><span style="color:#d08770;">{basename}</span><span style="color:#a3be8c;">-detail</span><span>&#39;,
</span><span>            </span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">True</span><span>,
</span><span>            </span><span style="color:#bf616a;">initkwargs</span><span>={&#39;</span><span style="color:#a3be8c;">suffix</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">Instance</span><span>&#39;}
</span><span>        ),
</span><span>        </span><span style="color:#65737e;"># Dynamic routes for custom actions
</span><span>        </span><span style="color:#bf616a;">DynamicRoute</span><span>(
</span><span>            </span><span style="color:#bf616a;">url</span><span>=</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#b48ead;">^</span><span style="color:#a3be8c;">{prefix}/{lookup}/{url_path}{trailing_slash}</span><span style="color:#b48ead;">$</span><span>&#39;,
</span><span>            </span><span style="color:#bf616a;">name</span><span>=&#39;</span><span style="color:#d08770;">{basename}</span><span style="color:#a3be8c;">-</span><span style="color:#d08770;">{url_name}</span><span>&#39;,
</span><span>            </span><span style="color:#bf616a;">detail</span><span>=</span><span style="color:#d08770;">True</span><span>,
</span><span>            </span><span style="color:#bf616a;">initkwargs</span><span>={}
</span><span>        ),
</span><span>    ]
</span></code></pre>
<h3 id="multiple-api-versions">Multiple API Versions</h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.routers </span><span style="color:#b48ead;">import </span><span>DefaultRouter
</span><span>
</span><span style="color:#65737e;"># Version 1
</span><span>router_v1 = </span><span style="color:#bf616a;">DefaultRouter</span><span>()
</span><span>router_v1.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">products</span><span>&#39;, ProductV1ViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">product</span><span>&#39;)
</span><span>
</span><span style="color:#65737e;"># Version 2
</span><span>router_v2 = </span><span style="color:#bf616a;">DefaultRouter</span><span>()
</span><span>router_v2.</span><span style="color:#bf616a;">register</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">products</span><span>&#39;, ProductV2ViewSet, </span><span style="color:#bf616a;">basename</span><span>=&#39;</span><span style="color:#a3be8c;">product</span><span>&#39;)
</span><span>
</span><span>urlpatterns = [
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/v1/</span><span>&#39;, </span><span style="color:#bf616a;">include</span><span>(router_v1.urls)),
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/v2/</span><span>&#39;, </span><span style="color:#bf616a;">include</span><span>(router_v2.urls)),
</span><span>]
</span></code></pre>
<h2 id="part-6-authentication-and-permissions">Part 6: Authentication and Permissions</h2>
<h3 id="authentication-classes">Authentication Classes</h3>
<h4 id="token-authentication">Token Authentication</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># settings.py
</span><span style="color:#bf616a;">INSTALLED_APPS </span><span>= [
</span><span>    </span><span style="color:#65737e;"># ...
</span><span>    &#39;</span><span style="color:#a3be8c;">rest_framework.authtoken</span><span>&#39;,
</span><span>]
</span><span>
</span><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_AUTHENTICATION_CLASSES</span><span>&#39;: [
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework.authentication.TokenAuthentication</span><span>&#39;,
</span><span>    ]
</span><span>}
</span><span>
</span><span style="color:#65737e;"># Run migration
</span><span style="color:#65737e;"># python manage.py migrate
</span><span>
</span><span style="color:#65737e;"># Create tokens for users
</span><span style="color:#b48ead;">from </span><span>rest_framework.authtoken.models </span><span style="color:#b48ead;">import </span><span>Token
</span><span>
</span><span>token = Token.objects.</span><span style="color:#bf616a;">create</span><span>(</span><span style="color:#bf616a;">user</span><span>=user)
</span><span style="color:#96b5b4;">print</span><span>(token.key)
</span></code></pre>
<h4 id="obtain-token-view">Obtain Token View</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.authtoken.views </span><span style="color:#b48ead;">import </span><span>obtain_auth_token
</span><span>
</span><span>urlpatterns = [
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/token/</span><span>&#39;, obtain_auth_token, </span><span style="color:#bf616a;">name</span><span>=&#39;</span><span style="color:#a3be8c;">api_token_auth</span><span>&#39;),
</span><span>]
</span><span>
</span><span style="color:#65737e;"># Custom token view
</span><span style="color:#b48ead;">from </span><span>rest_framework.authtoken.views </span><span style="color:#b48ead;">import </span><span>ObtainAuthToken
</span><span style="color:#b48ead;">from </span><span>rest_framework.authtoken.models </span><span style="color:#b48ead;">import </span><span>Token
</span><span style="color:#b48ead;">from </span><span>rest_framework.response </span><span style="color:#b48ead;">import </span><span>Response
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CustomAuthToken</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">ObtainAuthToken</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">post</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, *</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">kwargs</span><span>):
</span><span>        serializer = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">serializer_class</span><span>(
</span><span>            </span><span style="color:#bf616a;">data</span><span>=request.data,
</span><span>            </span><span style="color:#bf616a;">context</span><span>={&#39;</span><span style="color:#a3be8c;">request</span><span>&#39;: request}
</span><span>        )
</span><span>        serializer.</span><span style="color:#bf616a;">is_valid</span><span>(</span><span style="color:#bf616a;">raise_exception</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        user = serializer.validated_data[&#39;</span><span style="color:#a3be8c;">user</span><span>&#39;]
</span><span>        token, created = Token.objects.</span><span style="color:#bf616a;">get_or_create</span><span>(</span><span style="color:#bf616a;">user</span><span>=user)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>({
</span><span>            &#39;</span><span style="color:#a3be8c;">token</span><span>&#39;: token.key,
</span><span>            &#39;</span><span style="color:#a3be8c;">user_id</span><span>&#39;: user.pk,
</span><span>            &#39;</span><span style="color:#a3be8c;">email</span><span>&#39;: user.email,
</span><span>            &#39;</span><span style="color:#a3be8c;">username</span><span>&#39;: user.username
</span><span>        })
</span></code></pre>
<h4 id="jwt-authentication-using-djangorestframework-simplejwt">JWT Authentication (using djangorestframework-simplejwt)</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># settings.py
</span><span style="color:#bf616a;">INSTALLED_APPS </span><span>= [
</span><span>    </span><span style="color:#65737e;"># ...
</span><span>    &#39;</span><span style="color:#a3be8c;">rest_framework_simplejwt</span><span>&#39;,
</span><span>]
</span><span>
</span><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_AUTHENTICATION_CLASSES</span><span>&#39;: [
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework_simplejwt.authentication.JWTAuthentication</span><span>&#39;,
</span><span>    ]
</span><span>}
</span><span>
</span><span style="color:#b48ead;">from </span><span>datetime </span><span style="color:#b48ead;">import </span><span>timedelta
</span><span>
</span><span style="color:#bf616a;">SIMPLE_JWT </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">ACCESS_TOKEN_LIFETIME</span><span>&#39;: </span><span style="color:#bf616a;">timedelta</span><span>(</span><span style="color:#bf616a;">minutes</span><span>=</span><span style="color:#d08770;">60</span><span>),
</span><span>    &#39;</span><span style="color:#a3be8c;">REFRESH_TOKEN_LIFETIME</span><span>&#39;: </span><span style="color:#bf616a;">timedelta</span><span>(</span><span style="color:#bf616a;">days</span><span>=</span><span style="color:#d08770;">1</span><span>),
</span><span>    &#39;</span><span style="color:#a3be8c;">ROTATE_REFRESH_TOKENS</span><span>&#39;: </span><span style="color:#d08770;">False</span><span>,
</span><span>    &#39;</span><span style="color:#a3be8c;">BLACKLIST_AFTER_ROTATION</span><span>&#39;: </span><span style="color:#d08770;">True</span><span>,
</span><span>    &#39;</span><span style="color:#a3be8c;">ALGORITHM</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">HS256</span><span>&#39;,
</span><span>    &#39;</span><span style="color:#a3be8c;">SIGNING_KEY</span><span>&#39;: </span><span style="color:#bf616a;">SECRET_KEY</span><span>,
</span><span>    &#39;</span><span style="color:#a3be8c;">AUTH_HEADER_TYPES</span><span>&#39;: (&#39;</span><span style="color:#a3be8c;">Bearer</span><span>&#39;,),
</span><span>}
</span><span>
</span><span style="color:#65737e;"># urls.py
</span><span style="color:#b48ead;">from </span><span>rest_framework_simplejwt.views </span><span style="color:#b48ead;">import </span><span>(
</span><span>    TokenObtainPairView,
</span><span>    TokenRefreshView,
</span><span>)
</span><span>
</span><span>urlpatterns = [
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/token/</span><span>&#39;, TokenObtainPairView.</span><span style="color:#bf616a;">as_view</span><span>(), </span><span style="color:#bf616a;">name</span><span>=&#39;</span><span style="color:#a3be8c;">token_obtain_pair</span><span>&#39;),
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/token/refresh/</span><span>&#39;, TokenRefreshView.</span><span style="color:#bf616a;">as_view</span><span>(), </span><span style="color:#bf616a;">name</span><span>=&#39;</span><span style="color:#a3be8c;">token_refresh</span><span>&#39;),
</span><span>]
</span></code></pre>
<h4 id="custom-jwt-claims">Custom JWT Claims</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework_simplejwt.serializers </span><span style="color:#b48ead;">import </span><span>TokenObtainPairSerializer
</span><span style="color:#b48ead;">from </span><span>rest_framework_simplejwt.views </span><span style="color:#b48ead;">import </span><span>TokenObtainPairView
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CustomTokenObtainPairSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">TokenObtainPairSerializer</span><span style="color:#eff1f5;">):
</span><span>    @</span><span style="color:#96b5b4;">classmethod
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_token</span><span>(</span><span style="color:#bf616a;">cls</span><span>, </span><span style="color:#bf616a;">user</span><span>):
</span><span>        token = </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">get_token</span><span>(user)
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Add custom claims
</span><span>        token[&#39;</span><span style="color:#a3be8c;">username</span><span>&#39;] = user.username
</span><span>        token[&#39;</span><span style="color:#a3be8c;">email</span><span>&#39;] = user.email
</span><span>        token[&#39;</span><span style="color:#a3be8c;">is_staff</span><span>&#39;] = user.is_staff
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span>token
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CustomTokenObtainPairView</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">TokenObtainPairView</span><span style="color:#eff1f5;">):
</span><span>    serializer_class = CustomTokenObtainPairSerializer
</span></code></pre>
<h4 id="session-authentication">Session Authentication</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_AUTHENTICATION_CLASSES</span><span>&#39;: [
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework.authentication.SessionAuthentication</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework.authentication.BasicAuthentication</span><span>&#39;,
</span><span>    ]
</span><span>}
</span></code></pre>
<h4 id="multiple-authentication-methods">Multiple Authentication Methods</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_AUTHENTICATION_CLASSES</span><span>&#39;: [
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework_simplejwt.authentication.JWTAuthentication</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework.authentication.SessionAuthentication</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">rest_framework.authentication.TokenAuthentication</span><span>&#39;,
</span><span>    ]
</span><span>}
</span></code></pre>
<h3 id="permission-classes">Permission Classes</h3>
<h4 id="built-in-permissions">Built-in Permissions</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.permissions </span><span style="color:#b48ead;">import </span><span>(
</span><span>    IsAuthenticated,
</span><span>    IsAuthenticatedOrReadOnly,
</span><span>    AllowAny,
</span><span>    IsAdminUser,
</span><span>    DjangoModelPermissions,
</span><span>    DjangoObjectPermissions
</span><span>)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_permissions</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Different permissions for different actions.&quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.action in [&#39;</span><span style="color:#a3be8c;">list</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">retrieve</span><span>&#39;]:
</span><span>            permission_classes = [AllowAny]
</span><span>        </span><span style="color:#b48ead;">elif </span><span style="color:#bf616a;">self</span><span>.action == &#39;</span><span style="color:#a3be8c;">create</span><span>&#39;:
</span><span>            permission_classes = [IsAuthenticated]
</span><span>        </span><span style="color:#b48ead;">else</span><span>:
</span><span>            permission_classes = [IsAdminUser]
</span><span>        </span><span style="color:#b48ead;">return </span><span>[</span><span style="color:#bf616a;">permission</span><span>() </span><span style="color:#b48ead;">for </span><span>permission </span><span style="color:#b48ead;">in </span><span>permission_classes]
</span></code></pre>
<h4 id="custom-permissions">Custom Permissions</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>permissions
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">IsOwnerOrReadOnly</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">permissions.BasePermission</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    Custom permission to only allow owners of an object to edit it.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    message = &#39;</span><span style="color:#a3be8c;">You must be the owner to perform this action.</span><span>&#39;
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">has_object_permission</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">view</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        </span><span style="color:#65737e;"># Read permissions for any request
</span><span>        </span><span style="color:#b48ead;">if </span><span>request.method in permissions.</span><span style="color:#bf616a;">SAFE_METHODS</span><span>:
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">True
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Write permissions only for owner
</span><span>        </span><span style="color:#b48ead;">return </span><span>obj.owner == request.user
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">IsAuthorOrReadOnly</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">permissions.BasePermission</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    Custom permission for blog posts.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">has_permission</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">view</span><span>):
</span><span>        </span><span style="color:#65737e;"># Allow authenticated users to create
</span><span>        </span><span style="color:#b48ead;">if </span><span>request.method == &#39;</span><span style="color:#a3be8c;">POST</span><span>&#39;:
</span><span>            </span><span style="color:#b48ead;">return </span><span>request.user and request.user.is_authenticated
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">True
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">has_object_permission</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">view</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span>request.method in permissions.</span><span style="color:#bf616a;">SAFE_METHODS</span><span>:
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">True
</span><span>        </span><span style="color:#b48ead;">return </span><span>obj.author == request.user
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">IsPremiumUser</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">permissions.BasePermission</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Check if user has premium subscription.&quot;&quot;&quot;
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">has_permission</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">view</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span>(
</span><span>            request.user and
</span><span>            request.user.is_authenticated and
</span><span>            </span><span style="color:#96b5b4;">hasattr</span><span>(request.user, &#39;</span><span style="color:#a3be8c;">subscription</span><span>&#39;) and
</span><span>            request.user.subscription.is_active
</span><span>        )
</span></code></pre>
<h4 id="combining-permissions">Combining Permissions</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework.permissions </span><span style="color:#b48ead;">import </span><span>BasePermission, </span><span style="color:#bf616a;">SAFE_METHODS
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">IsOwnerOrAdmin</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BasePermission</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    Permission that allows owners or admins to edit.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">has_object_permission</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">view</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        </span><span style="color:#65737e;"># Admin can do anything
</span><span>        </span><span style="color:#b48ead;">if </span><span>request.user and request.user.is_staff:
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">True
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Owner can edit
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">hasattr</span><span>(obj, &#39;</span><span style="color:#a3be8c;">owner</span><span>&#39;):
</span><span>            </span><span style="color:#b48ead;">return </span><span>obj.owner == request.user
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">False
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CanPublishPost</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BasePermission</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;Complex business logic permission.&quot;&quot;&quot;
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">has_permission</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">view</span><span>):
</span><span>        </span><span style="color:#65737e;"># Must be authenticated
</span><span>        </span><span style="color:#b48ead;">if </span><span>not request.user or not request.user.is_authenticated:
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">False
</span><span>        
</span><span>        </span><span style="color:#65737e;"># Check if user can publish based on their role
</span><span>        </span><span style="color:#b48ead;">if </span><span>request.method == &#39;</span><span style="color:#a3be8c;">POST</span><span>&#39; and view.action == &#39;</span><span style="color:#a3be8c;">publish</span><span>&#39;:
</span><span>            </span><span style="color:#b48ead;">return </span><span>request.user.</span><span style="color:#bf616a;">has_perm</span><span>(&#39;</span><span style="color:#a3be8c;">blog.can_publish</span><span>&#39;)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">True
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">has_object_permission</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">view</span><span>, </span><span style="color:#bf616a;">obj</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span>view.action == &#39;</span><span style="color:#a3be8c;">publish</span><span>&#39;:
</span><span>            </span><span style="color:#65737e;"># Only author or editor can publish
</span><span>            </span><span style="color:#b48ead;">return </span><span>(
</span><span>                obj.author == request.user or
</span><span>                request.user.groups.</span><span style="color:#bf616a;">filter</span><span>(</span><span style="color:#bf616a;">name</span><span>=&#39;</span><span style="color:#a3be8c;">Editors</span><span>&#39;).</span><span style="color:#bf616a;">exists</span><span>()
</span><span>            )
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">True
</span><span>
</span><span style="color:#65737e;"># Using multiple permissions
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">PostViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Post.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = PostSerializer
</span><span>    permission_classes = [IsAuthenticated, IsOwnerOrAdmin, CanPublishPost]
</span></code></pre>
<h4 id="object-level-permissions-with-django-guardian">Object-Level Permissions with Django Guardian</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># Install: pip install django-guardian
</span><span>
</span><span style="color:#65737e;"># settings.py
</span><span style="color:#bf616a;">AUTHENTICATION_BACKENDS </span><span>= [
</span><span>    &#39;</span><span style="color:#a3be8c;">django.contrib.auth.backends.ModelBackend</span><span>&#39;,
</span><span>    &#39;</span><span style="color:#a3be8c;">guardian.backends.ObjectPermissionBackend</span><span>&#39;,
</span><span>]
</span><span>
</span><span style="color:#65737e;"># In view
</span><span style="color:#b48ead;">from </span><span>guardian.shortcuts </span><span style="color:#b48ead;">import </span><span>assign_perm, get_objects_for_user
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">DocumentViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    serializer_class = DocumentSerializer
</span><span>    permission_classes = [IsAuthenticated]
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_queryset</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Return only documents user has permission to view.&quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">get_objects_for_user</span><span>(
</span><span>            </span><span style="color:#bf616a;">self</span><span>.request.user,
</span><span>            &#39;</span><span style="color:#a3be8c;">documents.view_document</span><span>&#39;,
</span><span>            </span><span style="color:#bf616a;">klass</span><span>=Document
</span><span>        )
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">perform_create</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">serializer</span><span>):
</span><span>        document = serializer.</span><span style="color:#bf616a;">save</span><span>(</span><span style="color:#bf616a;">owner</span><span>=</span><span style="color:#bf616a;">self</span><span>.request.user)
</span><span>        </span><span style="color:#65737e;"># Assign permissions to creator
</span><span>        </span><span style="color:#bf616a;">assign_perm</span><span>(&#39;</span><span style="color:#a3be8c;">view_document</span><span>&#39;, </span><span style="color:#bf616a;">self</span><span>.request.user, document)
</span><span>        </span><span style="color:#bf616a;">assign_perm</span><span>(&#39;</span><span style="color:#a3be8c;">change_document</span><span>&#39;, </span><span style="color:#bf616a;">self</span><span>.request.user, document)
</span><span>        </span><span style="color:#bf616a;">assign_perm</span><span>(&#39;</span><span style="color:#a3be8c;">delete_document</span><span>&#39;, </span><span style="color:#bf616a;">self</span><span>.request.user, document)
</span></code></pre>
<h2 id="part-7-advanced-patterns">Part 7: Advanced Patterns</h2>
<h3 id="versioning">Versioning</h3>
<h4 id="url-path-versioning">URL Path Versioning</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># settings.py
</span><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_VERSIONING_CLASS</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">rest_framework.versioning.URLPathVersioning</span><span>&#39;,
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_VERSION</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">v1</span><span>&#39;,
</span><span>    &#39;</span><span style="color:#a3be8c;">ALLOWED_VERSIONS</span><span>&#39;: [&#39;</span><span style="color:#a3be8c;">v1</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">v2</span><span>&#39;],
</span><span>    &#39;</span><span style="color:#a3be8c;">VERSION_PARAM</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">version</span><span>&#39;,
</span><span>}
</span><span>
</span><span style="color:#65737e;"># urls.py
</span><span>urlpatterns = [
</span><span>    </span><span style="color:#bf616a;">path</span><span>(&#39;</span><span style="color:#a3be8c;">api/&lt;str:version&gt;/products/</span><span>&#39;, ProductListView.</span><span style="color:#bf616a;">as_view</span><span>()),
</span><span>]
</span><span>
</span><span style="color:#65737e;"># In view
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductListView</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">APIView</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, </span><span style="color:#bf616a;">version</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span>request.version == &#39;</span><span style="color:#a3be8c;">v1</span><span>&#39;:
</span><span>            serializer_class = ProductSerializerV1
</span><span>        </span><span style="color:#b48ead;">else</span><span>:
</span><span>            serializer_class = ProductSerializerV2
</span><span>        
</span><span>        products = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>        serializer = </span><span style="color:#bf616a;">serializer_class</span><span>(products, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span></code></pre>
<h4 id="accept-header-versioning">Accept Header Versioning</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#bf616a;">REST_FRAMEWORK </span><span>= {
</span><span>    &#39;</span><span style="color:#a3be8c;">DEFAULT_VERSIONING_CLASS</span><span>&#39;: &#39;</span><span style="color:#a3be8c;">rest_framework.versioning.AcceptHeaderVersioning</span><span>&#39;,
</span><span>}
</span><span>
</span><span style="color:#65737e;"># Client sends: Accept: application/json; version=1.0
</span></code></pre>
<h4 id="using-version-in-viewsets">Using Version in ViewSets</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_serializer_class</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.request.version == &#39;</span><span style="color:#a3be8c;">v1</span><span>&#39;:
</span><span>            </span><span style="color:#b48ead;">return </span><span>ProductSerializerV1
</span><span>        </span><span style="color:#b48ead;">return </span><span>ProductSerializerV2
</span><span>    
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_queryset</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        queryset = </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">get_queryset</span><span>()
</span><span>        
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.request.version == &#39;</span><span style="color:#a3be8c;">v2</span><span>&#39;:
</span><span>            </span><span style="color:#65737e;"># v2 includes more related data
</span><span>            queryset = queryset.</span><span style="color:#bf616a;">prefetch_related</span><span>(&#39;</span><span style="color:#a3be8c;">reviews</span><span>&#39;)
</span><span>        
</span><span>        </span><span style="color:#b48ead;">return </span><span>queryset
</span></code></pre>
<h3 id="caching">Caching</h3>
<h4 id="view-level-caching">View-Level Caching</h4>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.utils.decorators </span><span style="color:#b48ead;">import </span><span>method_decorator
</span><span style="color:#b48ead;">from </span><span>django.views.decorators.cache </span><span style="color:#b48ead;">import </span><span>cache_page
</span><span style="color:#b48ead;">from </span><span>django.views.decorators.vary </span><span style="color:#b48ead;">import </span><span>vary_on_cookie
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductListView</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">APIView</span><span style="color:#eff1f5;">):
</span><span>    @</span><span style="color:#bf616a;">method_decorator</span><span>(</span><span style="color:#bf616a;">cache_page</span><span>(</span><span style="color:#d08770;">60 </span><span>* </span><span style="color:#d08770;">15</span><span>))  </span><span style="color:#65737e;"># Cache for 15 minutes
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>):
</span><span>        products = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>        serializer = </span><span style="color:#bf616a;">ProductSerializer</span><span>(products, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Response</span><span>(serializer.data)
</span><span>
</span><span style="color:#65737e;"># With ViewSet
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ProductViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ReadOnlyModelViewSet</span><span style="color:#eff1f5;">):
</span><span>    queryset = Product.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>    serializer_class = ProductSerializer
</span><span>    
</span><span>    @</span><span style="color:#bf616a;">method_decorator</span><span>(</span><span style="color:#bf616a;">cache_page</span><span>(</span><span style="color:#d08770;">60 </span><span>* </span><span style="color:#d08770;">15</span><span>))
</span><span>    @</span><span style="color:#bf616a;">method_decorator</span><span>(vary_on_cookie)
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">list</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">request</span><span>, *</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">kwargs</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#bf616a;">list</span><span>(request, *args, **kwargs)
</span></code></pre>
</section>
  <hr />
  <!-- Post Taxonomies -->

  <!-- Begin Page End inject -->
  
  <!-- End Page End inject -->
</article>

  </main>
  <!-- Footer -->
<footer class="mx-auto flex lg:mt-5 max-w-3xl flex-wrap items-center px-4 py-3 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
  © <time datetime="2025">2025</time> HajMousa | <a href="https://creativecommons.org/licenses/by-sa/4.0/deed">CC BY-SA 4.0</a>
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <span class="mr-6 lg:ml-6">
      <a class="link" href="https://www.getzola.org/" target="_blank">Powered by Zola</a>
    </span>
    <a class="link" href="https://www.getzola.org/themes/linkita/" target="_blank">&#9998; Linkita</a>
  </div>
  <!-- Begin Footer inject -->
  
  <!-- End Footer inject -->
</footer>

  
  <link rel="stylesheet" href="https://blog.hajmousa.ir/katex/katex.min.css?h=e189fd0238811989c364" />
  <script defer src="https://blog.hajmousa.ir/katex/katex.min.js?h=6b909443e6c8f6e5d24c"></script>
  <script defer src="https://blog.hajmousa.ir/katex/contrib/auto-render.min.js?h=bb53eb953394531aae36"></script>
  <script>document.addEventListener("DOMContentLoaded", window.zolaTheme.katex.init);</script>

  <!-- Begin Body End inject -->
  
  <!-- End Body End inject -->
</body>

</html>
